
> pelocal_voice_ai_agent@0.1.0 test
> jest

PASS __tests__/components/AgentModal.test.tsx
PASS __tests__/app/page.conversation-history.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549274811_8rjl0hxfs

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Response from LLM

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275618_ke45ro3dg

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Real message

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Response from LLM

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276312_jy9ep2dkr

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Response from LLM

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

PASS __tests__/components/CampaignModal.test.tsx
PASS __tests__/app/page.continuous-call.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549274711_ajhxlaw4t

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549274979_w6ukgqfqi

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275075_hto09ncev

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275264_ojolcgg0z

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275399_i78i8of2f

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275465_co5m2gf02

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275610_24b0pdbsy

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275649_scynaillh

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.error
      [VoiceAIAgent] Failed to start call: Error: Microphone access denied
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.continuous-call.test.tsx:184:63)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:425:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275835_evbzs1dzp

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549275874_ushwjcp4t

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275961_qi2eq8du1

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549276013_hzpldb32x

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276098_ebewdvzie

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549276142_dvr13xagq

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276240_pxw2b35mu

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276450_5swpucuhq

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276580_qm8ks6p38

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276676_rozs8xqa8

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276773_uw93kmrsq

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276846_4mvb58yxa

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276908_aor7utnx1

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277053_ttmbd9q8a

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277102_myjyzsbi6

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Call ended, ignoring speech input

      at log (components/VoiceAIAgent.tsx:133:25)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277198_p2wyj814o

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277315_chn832xai

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549277372_2dhwj6rqf

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

PASS __tests__/components/CallLogsTable.test.tsx
  ● Console

    console.error
      Error fetching sessions: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/CallLogsTable.test.tsx:384:61)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/CallLogsTable.tsx:96:21)

    console.error
      [Error: Not implemented: navigation (except hash changes)] {
        type: 'not implemented'
      }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at Timeout._onTimeout (node_modules/jsdom/lib/jsdom/living/nodes/HTMLHyperlinkElementUtils-impl.js:80:7)

PASS __tests__/app/page.riya-default.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276663_fmb62rhxt

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276866_h6v6p31xj

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276987_g6ecse16f

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277182_1e4k2lgmo

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277264_zu2kfqla8

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277346_djwt419zk

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277435_bjc1nzlrz

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277545_3c9gmcu2x

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277643_28ykee43n

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: नमस्ते जी, मैं रिया बोल रही हूँ Punjab National Bank की तरफ़ से।

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277893_36qfbzg8f

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278001_3m2vif3r3

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278147_cqwm9gv7y

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278274_nzp92uwnx

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278416_1pzp7ml0m

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278541_5klu4sjoc

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278713_c89f1gyrc

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278805_gxdpk0zou

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278922_67ibpm3v8

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

PASS __tests__/app/page.stt-flow.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278140_n32upvjda

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549278356_yw00gne3e

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: hello there

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278649_gou8bp05l

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549278759_loomt8ddn

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.error
      [VoiceAIAgent] Error sending greeting: Error: unhandled: /api/tts
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.stt-flow.test.tsx:105:29
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:57:19)
          at fetch (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:319:39)
          at sendGreetingMessage (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:423:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:351:21)

    console.log
      [VoiceAIAgent] Processing speech: question

      at log (components/VoiceAIAgent.tsx:140:21)

    console.error
      [VoiceAIAgent] Real-time STT flow error: Error: LLM bad
          at onFinal (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:182:27)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:277:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278966_8ozfof3ss

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279082_i9rhhr8ov

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Processing speech: test input

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279255_18bb19suq

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279331_3pky3r9xz

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.warn
      [VoiceAIAgent] Greeting TTS failed

      346 |                 }
      347 |             } else {
    > 348 |                 console.warn('[VoiceAIAgent] Greeting TTS failed');
          |                         ^
      349 |             }
      350 |         } catch (error) {
      351 |             console.error('[VoiceAIAgent] Error sending greeting:', error);

      at warn (components/VoiceAIAgent.tsx:348:25)

    console.log
      [VoiceAIAgent] Processing speech: test input 2

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279450_qo8b887bu

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279551_q36qkkl58

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: hi

      at log (components/VoiceAIAgent.tsx:140:21)

PASS __tests__/components/VoiceAIAgent.additional-coverage.test.tsx (5.962 s)
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549274669_ggjk166su

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549274815_9ob43s5ae

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275036_nqwmk6ap5

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275105_4cby0yf3c

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275176_51okknguf

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: First question

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Processing speech: Second question

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275275_uyi8ud9yg

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275336_0fvji38k2

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Please hold

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: true

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Stopping audio playback

      at log (components/VoiceAIAgent.tsx:369:25)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549275395_atpe6flci

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Call ended during LLM processing, aborting

      at log (components/VoiceAIAgent.tsx:176:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275433_eoc5fvghk

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275486_gr02ag4h5

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Processing speech: Call will end before tts

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: true

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549275554_4yg0s5cwd

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Call ended during TTS generation, aborting

      at log (components/VoiceAIAgent.tsx:236:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275602_7zfttqego

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275675_nabwrdvwu

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Need pdf twice

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Doc

      at log (components/VoiceAIAgent.tsx:189:29)

    console.log
      [VoiceAIAgent] Processing speech: Need pdf second time

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Doc

      at log (components/VoiceAIAgent.tsx:189:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275765_0q4nb1xk6

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549275808_rwdo9v2gi

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Play audio now

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Ending conversation...

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:450:17)

    console.log
      [VoiceAIAgent] Stopping audio playback

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:457:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next conversation: session_1761549275858_egi9v5e3f

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:480:17)

    console.log
      [VoiceAIAgent] Conversation ended

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:483:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275901_fqwnafmf9

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275941_vjfhh0s4r

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Generate the pdf please

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Here is your document

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Report

      at log (components/VoiceAIAgent.tsx:551:25)

    console.log
      [VoiceAIAgent] PDF generated successfully: report.pdf

      at log (components/VoiceAIAgent.tsx:568:33)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276560_zfg3akj5m

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Please attempt pdf

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Trying to build pdf

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Doc

      at log (components/VoiceAIAgent.tsx:551:25)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277091_u18hw0t1g

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: trigger error

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.error
      [VoiceAIAgent] LLM failed: { error: 'Unexpected error occurred' }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:541:25)

    console.error
      [VoiceAIAgent] Text message processing error: Error: Unexpected error occurred
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:542:23

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:625:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277547_08043th87

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Do not speak

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: No audio for this

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277936_hz351qld3

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Play audio now

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Play audio

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278316_u86an62ov

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278498_b0p3qgeij

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: First line

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Reply for 1

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Sending text message: Second line

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Reply for 2

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279053_arz9mi1vj

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Ending conversation...

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:450:17)

    console.log
      [VoiceAIAgent] Generated new session ID for next conversation: session_1761549279123_4tlge099o

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:480:17)

    console.log
      [VoiceAIAgent] Conversation ended

      at Object.log [as onConfirm] (components/VoiceAIAgent.tsx:483:17)

    console.log
      [VoiceAIAgent] Sending text message: Are we open?

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Hello again

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279392_hu0sw58pi

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279417_aiev2weoi

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279552_ou9thjyge

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279588_zddgxf9nw

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Play and keep audio

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: true

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Stopping audio playback

      at log (components/VoiceAIAgent.tsx:369:25)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549279643_uoawn0403

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

PASS __tests__/app/page.audio-segment.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278317_p1umpx157

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549278594_nnfo2ipgv

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Hello from audio

      at Object.log [as onFinal] (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278846_zlk146s3n

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549278932_mjf3r60y7

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.error
      [VoiceAIAgent] Error sending greeting: Error: Unexpected URL /api/tts
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.audio-segment.test.tsx:89:29
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:57:19)
          at fetch (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:319:39)
          at sendGreetingMessage (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:423:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:351:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279065_ex59kg3lb

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279162_mvs9zybf8

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.error
      [VoiceAIAgent] Error sending greeting: Error: Unexpected URL /api/tts
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.audio-segment.test.tsx:117:29
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:57:19)
          at fetch (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:319:39)
          at sendGreetingMessage (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:423:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:351:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279261_mquv8953l

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279349_0e0e2xkc7

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.error
      [VoiceAIAgent] Error sending greeting: Error: Unexpected URL /api/tts
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.audio-segment.test.tsx:132:29
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:57:19)
          at fetch (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:319:39)
          at sendGreetingMessage (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:423:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:351:21)

    console.log
      [VoiceAIAgent] Processing speech: hello

      at Object.log [as onFinal] (components/VoiceAIAgent.tsx:140:21)

    console.error
      [VoiceAIAgent] Real-time STT flow error: Error: LLM service not configured
          at Object.onFinal (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:182:27)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as onFinal] (components/VoiceAIAgent.tsx:277:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279490_30pgci53g

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279581_jrja8o7dx

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.warn
      [VoiceAIAgent] Greeting TTS failed

      346 |                 }
      347 |             } else {
    > 348 |                 console.warn('[VoiceAIAgent] Greeting TTS failed');
          |                         ^
      349 |             }
      350 |         } catch (error) {
      351 |             console.error('[VoiceAIAgent] Error sending greeting:', error);

      at warn (components/VoiceAIAgent.tsx:348:25)

    console.log
      [VoiceAIAgent] Processing speech: hello

      at Object.log [as onFinal] (components/VoiceAIAgent.tsx:140:21)

PASS __tests__/components/VoiceAIAgent.speech-flows.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277721_9464655u1

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549277847_v2axzo910

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Customer said hello

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Summary

      at log (components/VoiceAIAgent.tsx:189:29)

    console.log
      [VoiceAIAgent] PDF generated successfully: report.pdf

      at log (components/VoiceAIAgent.tsx:206:37)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277922_fml59efiu

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549277967_ld46u71rq

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.warn
      [VoiceAIAgent] Greeting TTS failed

      346 |                 }
      347 |             } else {
    > 348 |                 console.warn('[VoiceAIAgent] Greeting TTS failed');
          |                         ^
      349 |             }
      350 |         } catch (error) {
      351 |             console.error('[VoiceAIAgent] Error sending greeting:', error);

      at warn (components/VoiceAIAgent.tsx:348:25)

    console.log
      [VoiceAIAgent] Processing speech: Need a fallback audio

      at log (components/VoiceAIAgent.tsx:140:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278049_nrcspncxq

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549278111_5w3kyei9b

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Processing speech: Trigger failure path

      at log (components/VoiceAIAgent.tsx:140:21)

    console.error
      [VoiceAIAgent] Real-time STT flow error: Error: LLM unavailable
          at onFinal (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:182:27)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/VoiceAIAgent.speech-flows.test.tsx:271:7

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:277:25)
      at __tests__/components/VoiceAIAgent.speech-flows.test.tsx:271:7

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278253_nt1cg42kv

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Call ended, ignoring speech input

      at log (components/VoiceAIAgent.tsx:133:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278292_texky6nw6

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello via text

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Assistant text reply

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Clear chat requested

      at log (components/VoiceAIAgent.tsx:435:17)

    console.log
      [VoiceAIAgent] Generated new session ID: session_1761549278853_xa68uid57

      at log (components/VoiceAIAgent.tsx:444:17)

    console.log
      [VoiceAIAgent] Chat cleared

      at log (components/VoiceAIAgent.tsx:446:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278893_srri91pwg

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Turn chat on

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Assistant response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: true

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549279308_z9eylkqdb

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279342_1n8ehrfsz

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279757_0dgw2txrk

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

PASS __tests__/components/VoiceAIAgent.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279727_bua7mkw5c

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279773_3mtv7o5ow

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello there

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: AI says hi

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280145_7p1rqonud

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Please create pdf

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Here is the report

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Report

      at log (components/VoiceAIAgent.tsx:551:25)

    console.log
      [VoiceAIAgent] PDF generated successfully: report.pdf

      at log (components/VoiceAIAgent.tsx:568:33)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280497_nnhspfrsx

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Cause error

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.error
      [VoiceAIAgent] LLM failed: { error: 'LLM down' }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:541:25)

    console.error
      [VoiceAIAgent] Text message processing error: Error: LLM down
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:542:23

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:625:21)

PASS __tests__/components/VoiceAIAgent.call-and-audio-errors.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279300_lwryn6dx1

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549279413_scf8mwztl

      at log (components/VoiceAIAgent.tsx:407:21)

    console.error
      [VoiceAIAgent] Failed to start call: Error: mic error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/VoiceAIAgent.call-and-audio-errors.test.tsx:16:57)
          at Runtime._execModule (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runtime/build/index.js:1268:24)
          at Runtime._loadModule (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runtime/build/index.js:944:12)
          at Runtime.requireModule (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runtime/build/index.js:832:12)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:95:13)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:425:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279511_5u6cke9hb

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: AI ok

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.error
      [VoiceAIAgent] Audio playback error]: Error: play failed
          at new RejectAudio (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/VoiceAIAgent.call-and-audio-errors.test.tsx:49:38)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:615:35

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:616:55)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279796_yu8yu8puu

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Need help

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.error
      [VoiceAIAgent] LLM failed: { error: 'LLM service not configured' }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:541:25)

    console.error
      [VoiceAIAgent] Text message processing error: Error: LLM service not configured
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:542:23

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:625:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280126_p0g1paynf

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Generate pdf please

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Assistant reply

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] PDF generation requested: Report

      at log (components/VoiceAIAgent.tsx:551:25)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280525_oil9fh5aj

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: No audio path

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Assistant note

      at log (components/VoiceAIAgent.tsx:546:21)

PASS __tests__/app/page.test.tsx (7.264 s)
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549274895_5gqlbpu52

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275043_ewyvx6qy2

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275117_3t6nzuxrs

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275203_87wxltgle

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275334_33o22l8u7

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275506_dgsqc0ayk

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275563_jobmbs299

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275679_dm4ed7iwr

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549275762_mc0qcniiv

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549276393_7qfj5c105

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello AI

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: AI response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277117_975e13ryw

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true } }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277577_1ias6gm7m

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549277720_fc47ldc40

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true } }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.error
      [VoiceAIAgent] LLM failed: { error: 'LLM service not configured' }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:541:25)

    console.error
      [VoiceAIAgent] Text message processing error: Error: LLM service not configured
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:542:23
          at runNextTicks (node:internal/process/task_queues:60:5)
          at processTimers (node:internal/timers:516:9)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:625:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278128_mocl6ozwk

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true } }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549278529_gvv4794ez

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test message

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Test response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.error
      [VoiceAIAgent] Text message processing error: Error: Not found
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.test.tsx:314:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:57:19)
          at fetch (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:594:39)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:625:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279173_lkhs0mqno

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Test response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Clear chat requested

      at log (components/VoiceAIAgent.tsx:435:17)

    console.log
      [VoiceAIAgent] Generated new session ID: session_1761549279543_0fslpw87s

      at log (components/VoiceAIAgent.tsx:444:17)

    console.log
      [VoiceAIAgent] Chat cleared

      at log (components/VoiceAIAgent.tsx:446:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549279615_1gj8r8gyb

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Test response

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Clear chat requested

      at log (components/VoiceAIAgent.tsx:435:17)

    console.log
      [VoiceAIAgent] Generated new session ID: session_1761549279912_lrjpjh83n

      at log (components/VoiceAIAgent.tsx:444:17)

    console.log
      [VoiceAIAgent] Chat cleared

      at log (components/VoiceAIAgent.tsx:446:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280002_36qpdnn4l

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280327_nrtztp26f

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280391_94d3unt9c

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280476_3pkugznsv

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280545_okvfjmy8q

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280620_golq49niq

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549280702_2qye0dh0o

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280784_1m83zuv0m

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549280874_2fwe3cd9v

      at log (components/VoiceAIAgent.tsx:407:21)

    console.error
      [VoiceAIAgent] Failed to start call: Error: Microphone access denied
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.test.tsx:775:63)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:425:25)

PASS __tests__/components/VoiceAgentsTable.test.tsx
  ● Console

    console.error
      Error fetching agents: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/VoiceAgentsTable.test.tsx:344:61)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAgentsTable.tsx:53:21)

PASS __tests__/components/Sidebar.test.tsx
  ● Console

    console.error
      [Sidebar] Error fetching sessions: Error: Failed to fetch sessions
          at fetchSessions (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/Sidebar.tsx:75:37)
          at runNextTicks (node:internal/process/task_queues:60:5)
          at listOnTimeout (node:internal/timers:545:9)
          at processTimers (node:internal/timers:519:7)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/Sidebar.tsx:79:21)

    console.error
      [Sidebar] Error fetching agents: Error: Failed to fetch agents
          at fetchAgents (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/Sidebar.tsx:91:37)
          at runNextTicks (node:internal/process/task_queues:60:5)
          at listOnTimeout (node:internal/timers:545:9)
          at processTimers (node:internal/timers:519:7)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/Sidebar.tsx:95:21)

    console.error
      [Sidebar] Error creating agent: Error: Failed to create agent
          at handleCreateAgent (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/Sidebar.tsx:119:37)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/Sidebar.tsx:126:21)

    console.error
      [Sidebar] Error deleting agent: Error: Failed to delete agent
          at handleDeleteAgent (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/Sidebar.tsx:165:37)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/Sidebar.tsx:169:21)

PASS __tests__/app/page.audio-flow.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549280547_bhmxnepcw

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.error
      [VoiceAIAgent] LLM failed: { error: 'Not found' }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:541:25)

    console.error
      [VoiceAIAgent] Text message processing error: Error: Not found
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:542:23

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:625:21)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549281028_klfnwy4vt

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Test

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Hello

      at log (components/VoiceAIAgent.tsx:546:21)

PASS __tests__/components/CampaignContactsModal.test.tsx
  ● Console

    console.error
      Error deleting contact: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/CampaignContactsModal.test.tsx:547:32)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/CampaignContactsModal.tsx:45:21)

PASS __tests__/components/PhoneNumberModal.test.tsx
  ● Console

    console.error
      Error saving phone number: Error: network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/PhoneNumberModal.test.tsx:250:30)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at runNextTicks (node:internal/process/task_queues:60:5)
          at listOnTimeout (node:internal/timers:545:9)
          at processTimers (node:internal/timers:519:7)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/PhoneNumberModal.tsx:140:21)

PASS __tests__/app/dashboard-page.smoke.test.tsx
  ● Console

    console.error
      Error retriggering campaign: Error: Failed to retrigger campaign
          at Object.handleRetriggerCampaign [as onRetriggerCampaign] (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/dashboard/page.tsx:238:23)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as onRetriggerCampaign] (app/dashboard/page.tsx:244:21)

PASS __tests__/app/page.split-layout.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549281755_ylovloy1w

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549281847_drhnr9j0m

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549281925_bma3ayrk9

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282018_qzck3cyl1

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282139_n3ck7u7kj

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282238_xrsdbdgju

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

PASS __tests__/components/ChatHistory.states.test.tsx
  ● Console

    console.log
      [ChatHistory] Fetched sessions: []

      at log (components/ChatHistory.tsx:75:21)

    console.error
      [ChatHistory] Error fetching sessions: Error: Failed to fetch sessions
          at fetchSessions (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/ChatHistory.tsx:70:23)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/ChatHistory.tsx:78:21)

    console.error
      [ChatHistory] Error fetching sessions: Error: Failed to fetch sessions
          at fetchSessions (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/ChatHistory.tsx:70:23)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/ChatHistory.tsx:78:21)

    console.log
      [ChatHistory] Fetched sessions: [
        {
          sessionId: 'session-initial',
          userId: 'mukul',
          messageCount: 3,
          firstMessage: 'Hello there',
          lastMessage: 'See you soon',
          lastTimestamp: '2025-10-27T06:59:42.051Z',
          firstTimestamp: '2025-10-27T06:14:42.051Z'
        }
      ]

      at log (components/ChatHistory.tsx:75:21)

    console.log
      [ChatHistory] Fetched messages for session: session-initial [
        {
          id: 'a',
          role: 'assistant',
          content: 'Greetings!',
          timestamp: '2025-10-27T07:00:42.051Z'
        },
        {
          id: 'b',
          role: 'user',
          content: 'Hello!',
          timestamp: '2025-10-27T07:01:42.051Z'
        }
      ]

      at log (components/ChatHistory.tsx:97:21)

    console.log
      [ChatHistory] Fetched sessions: [
        {
          sessionId: 'just-now',
          userId: 'mukul',
          messageCount: 1,
          firstMessage: 'Immediate',
          lastMessage: 'Immediate',
          lastTimestamp: '2025-10-27T07:14:42.136Z',
          firstTimestamp: '2025-10-27T07:14:42.136Z'
        },
        {
          sessionId: 'minutes-ago',
          userId: 'mukul',
          messageCount: 2,
          firstMessage: 'Few minutes ago',
          lastMessage: 'Few minutes ago',
          lastTimestamp: '2025-10-27T07:04:42.136Z',
          firstTimestamp: '2025-10-27T07:14:42.136Z'
        },
        {
          sessionId: 'hours-ago',
          userId: 'mukul',
          messageCount: 2,
          firstMessage: 'Hours ago',
          lastMessage: 'Hours ago',
          lastTimestamp: '2025-10-27T05:14:42.136Z',
          firstTimestamp: '2025-10-27T07:14:42.136Z'
        },
        {
          sessionId: 'days-ago',
          userId: 'mukul',
          messageCount: 2,
          firstMessage: 'Days ago',
          lastMessage: 'Days ago',
          lastTimestamp: '2025-10-24T07:14:42.136Z',
          firstTimestamp: '2025-10-27T07:14:42.136Z'
        },
        {
          sessionId: 'older',
          userId: 'mukul',
          messageCount: 2,
          firstMessage: 'Older',
          lastMessage: 'Older',
          lastTimestamp: '2024-10-27T07:14:42.136Z',
          firstTimestamp: '2024-10-27T07:14:42.136Z'
        }
      ]

      at log (components/ChatHistory.tsx:75:21)

    console.log
      [ChatHistory] Fetched sessions: [
        {
          sessionId: 's-err',
          userId: 'mukul',
          messageCount: 1,
          firstMessage: 'Hi',
          lastMessage: 'Bye',
          lastTimestamp: '2025-10-27T07:14:42.193Z',
          firstTimestamp: '2025-10-27T07:14:42.193Z'
        }
      ]

      at log (components/ChatHistory.tsx:75:21)

    console.error
      [ChatHistory] Error fetching messages: Error: Failed to fetch session messages
          at fetchSessionMessages (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/ChatHistory.tsx:92:23)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/ChatHistory.tsx:100:21)

    console.error
      [ChatHistory] Error fetching messages: Error: Failed to fetch session messages
          at fetchSessionMessages (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/ChatHistory.tsx:92:23)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/ChatHistory.tsx:100:21)

PASS __tests__/components/Sidebar.crud.test.tsx
PASS __tests__/app/page.greeting.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282264_lqtmdnp0y

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549282300_jfoy988ov

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282395_74iif7ftc

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549282417_rohft55fz

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282499_6esbpwf5z

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549282512_012or47h7

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.warn
      [VoiceAIAgent] Greeting TTS failed

      346 |                 }
      347 |             } else {
    > 348 |                 console.warn('[VoiceAIAgent] Greeting TTS failed');
          |                         ^
      349 |             }
      350 |         } catch (error) {
      351 |             console.error('[VoiceAIAgent] Error sending greeting:', error);

      at warn (components/VoiceAIAgent.tsx:348:25)

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282587_rf42h7nvc

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549282613_57ukrkj9x

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

PASS __tests__/api/llm.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: '',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.error
      [LLM] No user text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:60:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:79:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.error
      [LLM] Gemini API key not configured

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:99:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:97:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.error
      [LLM] LLM API error: Error: DB connection failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:106:39)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:319:17)
      at Object.<anonymous> (__tests__/api/llm.test.ts:113:24)

    console.error
      [LLM] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:323:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:113:24)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:328:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:113:24)

    console.error
      [LLM] Error message: DB connection failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:329:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:113:24)

    console.error
      [LLM] Error stack: Error: DB connection failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:106:39)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:330:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:113:24)

    console.error
      [LLM] Returning generic service error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:350:17)
      at Object.<anonymous> (__tests__/api/llm.test.ts:113:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Hello, how are you?',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello, how are you?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 54

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: Hello, how are you?

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: 0,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: '   ',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.error
      [LLM] No user text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:60:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:184:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 5035

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Hello! @#$%^&*() こんにちは 你好',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello! @#$%^&*() こんにちは 你好

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 60

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: Hello! @#$%^&*() こんにちは 你好

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Line 1\nLine 2\nLine 3',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Line 1
      Line 2
      Line 3

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 55

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: Line 1
      Line 2
      Line 3

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.error
      [LLM] LLM API error: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
          at JSON.parse (<anonymous>)
          at POST (app/api/llm/route.ts:50:70)
          at Object.<anonymous> (__tests__/api/llm.test.ts:254:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:319:17)
      at Object.<anonymous> (__tests__/api/llm.test.ts:254:24)

    console.error
      [LLM] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:323:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:254:24)

    console.error
      [LLM] Returning generic service error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:350:17)
      at Object.<anonymous> (__tests__/api/llm.test.ts:254:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: undefined,
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.error
      [LLM] No user text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:60:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:266:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 4,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 17

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): test
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: { status: 404, response: { data: 'Model not found' } }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:293:24)

    console.log
      [LLM] Error status: 404 body: Model not found

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] LLM HTTP status: 404 body: Model not found

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:274:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:293:24)

    console.error
      [LLM] Model or endpoint not found (404)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:277:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:293:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: { status: 401, response: { data: 'Unauthorized' } }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:319:24)

    console.log
      [LLM] Error status: 401 body: Unauthorized

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] LLM HTTP status: 401 body: Unauthorized

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:274:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:319:24)

    console.error
      [LLM] Authentication error: 401

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:281:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:319:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: { status: 429, response: { data: 'Rate limit exceeded' } }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:343:24)

    console.log
      [LLM] Error status: 429 body: Rate limit exceeded

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] LLM HTTP status: 429 body: Rate limit exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:274:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:343:24)

    console.error
      [LLM] Rate limit / quota exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:285:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:343:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview:

      at log (app/api/llm/route.ts:204:21)

    console.error
      [LLM] Received empty response from LLM

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:207:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:370:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: 'custom-session-123',
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'How are you?',
        sessionId: 'test-session',
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: How are you?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 74

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      ## Previous Conversation:
      User: Hi
      Assistant: Hello!
      
      User: How are you?

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: 'test-session',
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 2 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 1

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 1 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 49

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      ## Previous Conversation:
      User: Hi
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'How are you?',
        sessionId: 'test-session',
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.error
      [LLM] Failed to save user message: Error: DB save failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:538:45)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:90:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:554:24)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: How are you?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 74

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      ## Previous Conversation:
      User: Hi
      Assistant: Hello!
      
      User: How are you?

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.error
      [LLM] Could not initialize gemini-2.0-flash, attempting fallback model (gemini-pro). gemini-2.0-flash not available

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:117:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:585:24)

    console.log
      [LLM] Using fallback model: gemini-pro

      at log (app/api/llm/route.ts:120:25)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Fallback response

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 17

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.error
      [LLM] Could not initialize gemini-2.0-flash, attempting fallback model (gemini-pro). Model initialization failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:117:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:607:24)

    console.error
      [LLM] Failed to initialize any supported model: Error: Model initialization failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:598:17)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as getGenerativeModel] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at getGenerativeModel (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:119:31)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:607:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:122:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:607:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: undefined

      at log (app/api/llm/route.ts:204:21)

    console.error
      [LLM] Received empty response from LLM

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:207:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:633:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Format 2

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["output"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Format 3

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["candidates"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Format 4

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: Direct string

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Direct string

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 13

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Plain text field

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 16

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Generate PDF',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Generate PDF

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 20

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Generate PDF

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Here is your response. <<<PDF>>>{"title":"Test Report","content":"Test content","type":"report"}<<</PDF>>>

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 106

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] PDF command detected in response

      at log (app/api/llm/route.ts:241:29)

    console.log
      [LLM] PDF command extracted: Test Report

      at log (app/api/llm/route.ts:246:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Generate PDF',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Generate PDF

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 20

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Generate PDF

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Response with <<<PDF>>>invalid json<<</PDF>>> invalid content

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 61

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] PDF command detected in response

      at log (app/api/llm/route.ts:241:29)

    console.error
      [LLM] Failed to parse PDF command: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
          at JSON.parse (<anonymous>)
          at parse (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:243:39)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:739:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:248:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:739:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: API_KEY
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:752:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:761:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:761:24)

    console.log
      [LLM] Error status: null body: API_KEY

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:761:24)

    console.error
      [LLM] Error message: API_KEY

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:761:24)

    console.error
      [LLM] Error stack: Error: API_KEY
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:752:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:761:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:761:24)

    console.error
      [LLM] Invalid or missing API key detected

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:297:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:761:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: SAFETY
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:773:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:782:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:782:24)

    console.log
      [LLM] Error status: null body: SAFETY

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:782:24)

    console.error
      [LLM] Error message: SAFETY

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:782:24)

    console.error
      [LLM] Error stack: Error: SAFETY
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:773:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:782:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:782:24)

    console.error
      [LLM] Content filtered by safety policies

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:301:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:782:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: QUOTA_EXCEEDED
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:794:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:803:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:803:24)

    console.log
      [LLM] Error status: null body: QUOTA_EXCEEDED

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:803:24)

    console.error
      [LLM] Error message: QUOTA_EXCEEDED

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:803:24)

    console.error
      [LLM] Error stack: Error: QUOTA_EXCEEDED
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:794:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:803:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:803:24)

    console.error
      [LLM] API quota exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:305:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:803:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: 404 Not Found
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:815:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:824:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:824:24)

    console.log
      [LLM] Error status: null body: 404 Not Found

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:824:24)

    console.error
      [LLM] Error message: 404 Not Found

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:824:24)

    console.error
      [LLM] Error stack: Error: 404 Not Found
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:815:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:824:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:824:24)

    console.error
      [LLM] Model not found or invalid API key

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:309:29)
      at Object.<anonymous> (__tests__/api/llm.test.ts:824:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: Generic LLM error
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:837:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:846:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:846:24)

    console.log
      [LLM] Error status: null body: Generic LLM error

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:846:24)

    console.error
      [LLM] Error message: Generic LLM error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:846:24)

    console.error
      [LLM] Error stack: Error: Generic LLM error
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:837:56)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:846:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:846:24)

    console.error
      [LLM] Returning generic generate error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:314:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:846:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.error
      [LLM] Model does not expose generateContent or generate methods

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:196:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:866:24)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: Model does not expose generateContent or generate methods
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:197:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:866:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:866:24)

    console.log
      [LLM] Error status: null body: Model does not expose generateContent or generate methods

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:866:24)

    console.error
      [LLM] Error message: Model does not expose generateContent or generate methods

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:866:24)

    console.error
      [LLM] Error stack: Error: Model does not expose generateContent or generate methods
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:197:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.test.ts:866:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.test.ts:866:24)

    console.error
      [LLM] Returning generic generate error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:314:21)
      at Object.<anonymous> (__tests__/api/llm.test.ts:866:24)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["invalidFormat"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: {"invalidFormat":"no valid text extraction path"}

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 49

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: 'test-session',
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 2 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 1

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 1 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 49

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      ## Previous Conversation:
      User: Hi
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

PASS __tests__/components/WhatsAppNumberModal.test.tsx
PASS __tests__/components/DashboardSidebar.test.tsx
PASS __tests__/components/Sidebar.error-flows.test.tsx
  ● Console

    console.error
      [Sidebar] Error updating agent: Error: Failed to update agent
          at handleUpdateAgent (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/Sidebar.tsx:145:37)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/Sidebar.tsx:152:21)

    console.error
      [Sidebar] Error deleting agent: Error: Failed to delete agent
          at handleDeleteAgent (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/Sidebar.tsx:165:37)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/Sidebar.tsx:169:21)

PASS __tests__/components/CampaignsTable.test.tsx
PASS __tests__/app/page.text-tts-ended.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549282966_kk5ljn8bn

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hi there

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Hello world

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

PASS __tests__/api/llm.conversation-history.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'When is it due?',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: When is it due?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 129

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      ## Previous Conversation:
      User: What is my EMI?
      Assistant: Your EMI is ₹3,000
      
      User: When is it due?

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 40

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 40

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 40

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'When is it due?',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: When is it due?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 143

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a banking assistant
      
      ## Previous Conversation:
      User: What is my EMI amount?
      Assistant: Your EMI amount is ₹3,000
      
      User: When is it due?

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: The EMI is due on 20th

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 22

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Current message',
        sessionId: undefined,
        historyLength: 6
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 7 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Current message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 6

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 6 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 177

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: Message 1
      Assistant: Response 1
      User: Message 2
      Assistant: Response 2
      User: Message 3
      Assistant: Response 3
      
      User: Current message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Response

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Latest message',
        sessionId: undefined,
        historyLength: 50
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 51 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Latest message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 50

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 20 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 612

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: User message 16
      Assistant: Assistant response 16
      User: User message 17
      Assistant: Assistant response 17
      User: User message 18
      Assistant: Assistant respon

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Response

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 17,
        userText: '  Current message  ',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Current message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 123

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User:   What is my EMI?  
      Assistant:   Your EMI is ₹3,000  
      
      User: Current message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Response

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Current message',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Current message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 95

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: Message 1
      User: Message 2
      
      User: Current message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Current message',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Current message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 107

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      Assistant: Response 1
      Assistant: Response 2
      
      User: Current message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Tell me more',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Tell me more

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 138

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: What about $1,000 & 50%?
      Assistant: The amount is $1,000 (50% discount)
      
      User: Tell me more

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Continue',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Continue

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 123

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: Line 1
      Line 2
      Line 3
      Assistant: Response with
      multiple lines
      
      User: Continue

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Continue',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Continue

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 5089

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Real message',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Real message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 96

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: 
      Assistant: Response to empty
      
      User: Real message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'How are you?',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: How are you?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 80

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      ## Previous Conversation:
      User: Hello
      Assistant: Hi there!
      
      User: How are you?

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Latest',
        sessionId: undefined,
        historyLength: 20
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 21 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Latest

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 20

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 20 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 385

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: Message 1
      User: Message 2
      User: Message 3
      User: Message 4
      User: Message 5
      User: Message 6
      User: Message 7
      User: Message 8
      User: Message 9
      User: Message 1

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Next message',
        sessionId: undefined,
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 2 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Next message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 1

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 1 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 81

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: Single message
      
      User: Next message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: '   ',
        sessionId: undefined,
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.error
      [LLM] No user text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:60:21)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:525:30)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Current message',
        sessionId: undefined,
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 2 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.error
      [LLM] Gemini API key not configured

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:99:21)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:548:30)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Current message',
        sessionId: undefined,
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 2 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Current message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.error
      [LLM] Could not initialize gemini-2.0-flash, attempting fallback model (gemini-pro). Model initialization failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:117:21)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:576:30)

    console.error
      [LLM] Failed to initialize any supported model: Error: Model initialization failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.conversation-history.test.ts:559:27)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as getGenerativeModel] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at getGenerativeModel (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:119:31)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.conversation-history.test.ts:576:30)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:122:25)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:576:30)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 13,
        userText: 'Current message',
        sessionId: undefined,
        historyLength: 1
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 2 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Current message

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 1

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 1 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 86

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): System prompt
      
      ## Previous Conversation:
      User: Previous message
      
      User: Current message

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: Generation failed
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.conversation-history.test.ts:587:66)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.conversation-history.test.ts:604:30)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:604:30)

    console.log
      [LLM] Error status: null body: Generation failed

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:604:30)

    console.error
      [LLM] Error message: Generation failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:604:30)

    console.error
      [LLM] Error stack: Error: Generation failed
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.conversation-history.test.ts:587:66)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.conversation-history.test.ts:604:30)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:604:30)

    console.error
      [LLM] Returning generic generate error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:314:21)
      at Object.<anonymous> (__tests__/api/llm.conversation-history.test.ts:604:30)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'I want to pay it',
        sessionId: undefined,
        historyLength: 2
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 3 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: I want to pay it

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 2

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 2 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 156

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a banking assistant
      
      ## Previous Conversation:
      User: What is my EMI amount?
      Assistant: Your EMI amount is ₹3,000 due on 20th
      
      User: I want to pay it

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Sure, I can help you pay your EMI of ₹3,000

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 43

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 36,
        userText: 'कैसे करूं payment?',
        sessionId: undefined,
        historyLength: 4
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 5 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: कैसे करूं payment?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 4

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 4 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 268

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a Hinglish banking assistant
      
      ## Previous Conversation:
      User: मुझे अपनी EMI के बारे में जानना है
      Assistant: आपकी EMI ₹3,000 है जो 20 तारीख को due थी
      User: क्या मैं इसे अभी pay कर सकता हूं?
      Ass

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 27,
        userText: 'What did we discuss?',
        sessionId: undefined,
        historyLength: 20
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 21 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: What did we discuss?

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 20

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 20 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 454

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): You are a helpful assistant
      
      ## Previous Conversation:
      User: Question 1
      Assistant: Answer 1
      User: Question 2
      Assistant: Answer 2
      User: Question 3
      Assistant: Answer 3
      User: Question 4
      Assistant: Answer

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: This is a test response from the LLM.

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 37

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

PASS __tests__/components/ChatBox.test.tsx
PASS __tests__/components/PhoneNumbersTable.test.tsx
  ● Console

    console.error
      Error fetching phone numbers: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/components/PhoneNumbersTable.test.tsx:222:37)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/PhoneNumbersTable.tsx:47:21)

PASS __tests__/app/page.audio-generic-config-error.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549284023_14g2am4tx

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549284173_3kfe31fni

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.error
      [VoiceAIAgent] Error sending greeting: Error: Unexpected URL /api/tts
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/app/page.audio-generic-config-error.test.tsx:51:29
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:57:19)
          at fetch (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:319:39)
          at sendGreetingMessage (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:423:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (components/VoiceAIAgent.tsx:351:21)

    console.log
      [VoiceAIAgent] Processing speech: test message

      at Object.log [as onFinal] (components/VoiceAIAgent.tsx:140:21)

    console.error
      [VoiceAIAgent] Real-time STT flow error: Error: LLM service not configured
          at Object.onFinal (/home/pelocal/pelocal/pelocal_voice_ai_agent/components/VoiceAIAgent.tsx:182:27)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as onFinal] (components/VoiceAIAgent.tsx:277:25)

PASS __tests__/components/TopModelBoxes.test.tsx
PASS __tests__/app/page.restart-confirm.mocked.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549284005_u2y704aka

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: hello

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: undefined

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] Clear chat requested

      at log (components/VoiceAIAgent.tsx:435:17)

    console.log
      [VoiceAIAgent] Generated new session ID: session_1761549284590_bhdswg775

      at log (components/VoiceAIAgent.tsx:444:17)

    console.log
      [VoiceAIAgent] Chat cleared

      at log (components/VoiceAIAgent.tsx:446:17)

PASS __tests__/components/ChatHistory.basic.test.tsx
  ● Console

    console.log
      [ChatHistory] Fetched sessions: [
        {
          sessionId: 's1',
          userId: 'u',
          messageCount: 1,
          firstMessage: 'hi',
          lastMessage: 'bye',
          lastTimestamp: '2025-10-27T07:14:44.837Z',
          firstTimestamp: '2025-10-27T07:14:44.838Z'
        }
      ]

      at log (components/ChatHistory.tsx:75:21)

    console.log
      [ChatHistory] Fetched messages for session: s1 [
        {
          id: 'm1',
          role: 'assistant',
          content: 'Hello',
          timestamp: '2025-10-27T07:14:44.908Z'
        }
      ]

      at log (components/ChatHistory.tsx:97:21)

    console.log
      [ChatHistory] Fetched messages for session: s1 [
        {
          id: 'm1',
          role: 'assistant',
          content: 'Hello',
          timestamp: '2025-10-27T07:14:44.908Z'
        }
      ]

      at log (components/ChatHistory.tsx:97:21)

    console.log
      [ChatHistory] Fetched sessions: [
        {
          sessionId: 's1',
          userId: 'u',
          messageCount: 1,
          firstMessage: 'hi',
          lastMessage: 'bye',
          lastTimestamp: '2025-10-27T07:14:44.942Z',
          firstTimestamp: '2025-10-27T07:14:44.942Z'
        }
      ]

      at log (components/ChatHistory.tsx:75:21)

PASS __tests__/app/page.audio-tts-ended.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549284868_fvudj8fu8

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: false isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Starting fresh call...

      at log (components/VoiceAIAgent.tsx:398:21)

    console.log
      [VoiceAIAgent] Generated new session ID for call: session_1761549284983_zqhlmkxkj

      at log (components/VoiceAIAgent.tsx:407:21)

    console.log
      [VoiceAIAgent] Call started successfully

      at log (components/VoiceAIAgent.tsx:420:25)

    console.log
      [VoiceAIAgent] Sending automatic greeting message

      at log (components/VoiceAIAgent.tsx:303:17)

    console.log
      [VoiceAIAgent] Playing greeting audio

      at log (components/VoiceAIAgent.tsx:345:29)

    console.log
      [VoiceAIAgent] Processing speech: Hi from audio

      at log (components/VoiceAIAgent.tsx:140:21)

PASS __tests__/components/Sidebar.basic.test.tsx
PASS __tests__/app/page.end-dialog-cancel.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549284744_yczhnwno7

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hi

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: Some reply

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

    console.log
      [VoiceAIAgent] Clear chat requested

      at log (components/VoiceAIAgent.tsx:435:17)

    console.log
      [VoiceAIAgent] Generated new session ID: session_1761549285151_s005j9da2

      at log (components/VoiceAIAgent.tsx:444:17)

    console.log
      [VoiceAIAgent] Chat cleared

      at log (components/VoiceAIAgent.tsx:446:17)

PASS __tests__/components/MicButton.test.tsx
PASS __tests__/lib/whatsAppService.test.ts
  ● Console

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at Object.info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageResponse with response field: { messaging_product: 'whatsapp', contacts: [], messages: [] }

      at Object.info (lib/whatsAppService.ts:201:21)

    console.warn
      MetaMessageResponse with response field: { messaging_product: 'whatsapp', contacts: [], messages: [] }

      200 |         if (metaResponse.response) {
      201 |             console.info('MetaMessageResponse with response field:', metaResponse.response);
    > 202 |             console.warn('MetaMessageResponse with response field:', metaResponse.response);
          |                     ^
      203 |             return metaResponse.response as MetaMessageResponse;
      204 |         }
      205 |         return metaResponse as MetaMessageResponse;

      at Object.warn (lib/whatsAppService.ts:202:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:80:20)

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.error
      Meta WhatsApp API configuration is missing. Cannot send WhatsApp message.

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/whatsAppService.ts:180:21)
      at Object.sendMessage (__tests__/lib/whatsAppService.test.ts:96:42)

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at Object.info (lib/whatsAppService.ts:191:17)

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at Object.info (lib/whatsAppService.ts:191:17)

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at Object.info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'hello' }
      }

      at Object.info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at Object.info (lib/whatsAppService.ts:191:17)

    console.info
      Error in sendMessage: 500 server error

      at Object.info (lib/whatsAppService.ts:194:21)

    console.error
      Error in sendMessage: 500 server error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/whatsAppService.ts:195:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:193:20)

    console.warn
      Error in sendMessage: 500 server error

      194 |             console.info('Error in sendMessage:', response.status, errorText);
      195 |             console.error('Error in sendMessage:', response.status, errorText);
    > 196 |             console.warn('Error in sendMessage:', response.status, errorText);
          |                     ^
      197 |             return null;
      198 |         }
      199 |         const metaResponse = await response.json();

      at Object.warn (lib/whatsAppService.ts:196:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:193:20)

    console.info
      Entering sendMessage method

      at Object.info (lib/whatsAppService.ts:176:13)

    console.error
      Exception in sendMessage network down

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/whatsAppService.ts:207:17)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:206:20)

    console.warn
      WhatsApp callback received with no message payload

      252 |
      253 |         if (!message) {
    > 254 |             console.warn('WhatsApp callback received with no message payload');
          |                     ^
      255 |             return;
      256 |         }
      257 |

      at Object.warn (lib/whatsAppService.ts:254:21)
      at Object.processWhatsAppCallback (__tests__/lib/whatsAppService.test.ts:267:29)

    console.error
      Unable to resolve WhatsApp numbers from payload

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/whatsAppService.ts:266:21)
      at Object.processWhatsAppCallback (__tests__/lib/whatsAppService.test.ts:276:29)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Env agent reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Fallback reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.error
      Voice agent pipeline error: Model timeout

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/whatsAppService.ts:344:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:376:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'I am facing an issue generating a response right now. Please try again later.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Agent reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.error
      No voice agent configured for WhatsApp number

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/whatsAppService.ts:307:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:448:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'Sorry, we are unable to process your request right now.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:481:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:511:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:534:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:564:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:588:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:611:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Session test reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Metadata fallback reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Latest reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Recovered reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: { preview_url: false, body: 'Fallback reply' }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

    console.warn
      Received non-text message. Responding with unsupported notice.

      314 |
      315 |         if (!shouldProcessAsText) {
    > 316 |             console.warn('Received non-text message. Responding with unsupported notice.');
          |                     ^
      317 |             const unsupported = 'This channel currently supports text messages only. Please send your query as text.';
      318 |             await sendAndPersistOutbound(sessionId, customerNumber, unsupported, 'unsupported', agent.id, undefined, sendOptions);
      319 |             return;

      at Object.warn (lib/whatsAppService.ts:316:21)
      at Object.<anonymous> (__tests__/lib/whatsAppService.test.ts:771:7)

    console.info
      MetaMessageRequest: {
        messaging_product: 'whatsapp',
        recipient_type: 'individual',
        to: '919876543210',
        type: 'text',
        text: {
          preview_url: false,
          body: 'This channel currently supports text messages only. Please send your query as text.'
        }
      }

      at info (lib/whatsAppService.ts:239:13)

    console.info
      Entering sendMessage method

      at info (lib/whatsAppService.ts:176:13)

    console.info
      Meta API call completed

      at info (lib/whatsAppService.ts:191:17)

PASS __tests__/app/agents-page.text-chat.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549285099_7p4o8hm2q

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] Sending text message: Hello

      at log (components/VoiceAIAgent.tsx:490:17)

    console.log
      [VoiceAIAgent] Sending request to LLM with conversation history...

      at log (components/VoiceAIAgent.tsx:532:21)

    console.log
      [VoiceAIAgent] LLM response: AI says hi

      at log (components/VoiceAIAgent.tsx:546:21)

    console.log
      [VoiceAIAgent] TTS audio generated, playing...

      at log (components/VoiceAIAgent.tsx:610:29)

PASS __tests__/components/WhatsAppNumbersTable.test.tsx
PASS __tests__/components/ConfirmDialog.test.tsx
PASS __tests__/app/page.text-input-focus.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549285685_splc555uz

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: 200

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'ok'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

PASS __tests__/app/agents-page.comprehensive.test.tsx
PASS __tests__/components/InitialPromptEditor.riya-template.test.tsx
PASS __tests__/hooks/useVoiceRecorder.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'test',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: test

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.01, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 1000 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.error
      [useVoiceRecorder] Error starting recording: Error: Permission denied
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/hooks/useVoiceRecorder.test.tsx:299:46)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as startRecording] (hooks/useVoiceRecorder.ts:236:21)
      at __tests__/hooks/useVoiceRecorder.test.tsx:309:11

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'test',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: test

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Audio level: 0.0000, Threshold: 0.005, isListening: true

      at log (hooks/useVoiceRecorder.ts:79:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

PASS __tests__/components/AudioLevelIndicator.test.tsx
PASS __tests__/hooks/useContinuousCall.test.ts
  ● Console

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.error
      [useContinuousCall] Failed to start call: Error: Permission denied
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/hooks/useContinuousCall.test.ts:117:40)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as startCall] (hooks/useContinuousCall.ts:125:21)
      at __tests__/hooks/useContinuousCall.test.ts:124:7

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at Object.log [as endCall] (hooks/useContinuousCall.ts:182:17)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] No active call to end

      at Object.log [as endCall] (hooks/useContinuousCall.ts:144:21)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Call already active

      at Object.log [as startCall] (hooks/useContinuousCall.ts:68:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at Object.log [as endCall] (hooks/useContinuousCall.ts:182:17)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at Object.log [as endCall] (hooks/useContinuousCall.ts:182:17)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm;codecs=opus

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] No active call to end

      at Object.log [as endCall] (hooks/useContinuousCall.ts:144:21)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] No active call to end

      at Object.log [as endCall] (hooks/useContinuousCall.ts:144:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/webm

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] No active call to end

      at Object.log [as endCall] (hooks/useContinuousCall.ts:144:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.log
      [useContinuousCall] Using MIME type: audio/mp4

      at Object.log [as startCall] (hooks/useContinuousCall.ts:104:21)

    console.log
      [useContinuousCall] Call started successfully

      at Object.log [as startCall] (hooks/useContinuousCall.ts:122:21)

    console.log
      [useContinuousCall] Ending call...

      at log (hooks/useContinuousCall.ts:141:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Stopped track: undefined

      at log (hooks/useContinuousCall.ts:167:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Call ended successfully

      at log (hooks/useContinuousCall.ts:182:17)
          at Array.forEach (<anonymous>)

    console.log
      [useContinuousCall] Starting call...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:65:17)

    console.log
      [useContinuousCall] Requesting microphone access...

      at Object.log [as startCall] (hooks/useContinuousCall.ts:76:21)

    console.log
      [useContinuousCall] Microphone access granted

      at Object.log [as startCall] (hooks/useContinuousCall.ts:87:21)

    console.error
      [useContinuousCall] Failed to start call: Error: AudioContext not supported
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/hooks/useContinuousCall.test.ts:362:13)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at Object.startCall (/home/pelocal/pelocal/pelocal_voice_ai_agent/hooks/useContinuousCall.ts:91:39)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/hooks/useContinuousCall.test.ts:370:7

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as startCall] (hooks/useContinuousCall.ts:125:21)
      at __tests__/hooks/useContinuousCall.test.ts:370:7

    console.log
      [useContinuousCall] Ending call...

      at Object.log [as endCall] (hooks/useContinuousCall.ts:141:17)

    console.log
      [useContinuousCall] No active call to end

      at Object.log [as endCall] (hooks/useContinuousCall.ts:144:21)

PASS __tests__/components/InitialPromptEditor.test.tsx
PASS __tests__/app/agents-page.smoke.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549286637_x7vmzbkwl

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: { services: { stt: true, llm: true, tts: true }, allConfigured: true }

      at log (components/VoiceAIAgent.tsx:100:25)

PASS __tests__/app/page.mic-close.test.tsx
  ● Console

    console.log
      [VoiceAIAgent] Checking API configuration status...

      at log (components/VoiceAIAgent.tsx:87:17)

    console.log
      [VoiceAIAgent] Generated session ID: session_1761549286749_eij1ppx3g

      at log (components/VoiceAIAgent.tsx:92:17)

    console.log
      [VoiceAIAgent] Config status response received: undefined

      at log (components/VoiceAIAgent.tsx:96:25)

    console.log
      [VoiceAIAgent] Config status data: {
        services: { stt: true, llm: true, tts: true },
        allConfigured: true,
        message: 'All services configured'
      }

      at log (components/VoiceAIAgent.tsx:100:25)

    console.log
      [VoiceAIAgent] handleCallToggle called, isCallActive: true isChatOpen: false

      at log (components/VoiceAIAgent.tsx:359:17)

    console.log
      [VoiceAIAgent] Ending call...

      at log (components/VoiceAIAgent.tsx:362:21)

    console.log
      [VoiceAIAgent] Generated new session ID for next call: session_1761549286884_369eeh4jj

      at log (components/VoiceAIAgent.tsx:394:21)

    console.log
      [VoiceAIAgent] Call ended successfully

      at log (components/VoiceAIAgent.tsx:396:21)

PASS __tests__/hooks/useVoiceRecorder.branch-gaps.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.001, silenceTimeout: 20 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Audio level: 0.0000, Threshold: 0.001, isListening: true

      at log (hooks/useVoiceRecorder.ts:79:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.001, silenceTimeout: 20 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Audio level: 0.0000, Threshold: 0.001, isListening: true

      at log (hooks/useVoiceRecorder.ts:79:21)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.001, silenceTimeout: 20 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Silence timeout reached, stopping segment

      at log (hooks/useVoiceRecorder.ts:94:29)

    console.log
      [useVoiceRecorder] stopSegment called

      at log (hooks/useVoiceRecorder.ts:38:17)

    console.log
      [useVoiceRecorder] MediaRecorder not recording, state: inactive

      at log (hooks/useVoiceRecorder.ts:44:21)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:48:21)

    console.log
      [useVoiceRecorder] Audio level: 1.0000, Threshold: 0.001, isListening: true

      at log (hooks/useVoiceRecorder.ts:79:21)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.001, silenceTimeout: 20 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Audio level: 0.0000, Threshold: 0.001, isListening: true

      at log (hooks/useVoiceRecorder.ts:79:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.001, silenceTimeout: 20 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Audio level: 0.0000, Threshold: 0.001, isListening: true

      at log (hooks/useVoiceRecorder.ts:79:21)

    console.log
      [useVoiceRecorder] Silence timeout reached, stopping segment

      at log (hooks/useVoiceRecorder.ts:94:29)

    console.log
      [useVoiceRecorder] stopSegment called

      at log (hooks/useVoiceRecorder.ts:38:17)

    console.log
      [useVoiceRecorder] MediaRecorder not recording, state: inactive

      at log (hooks/useVoiceRecorder.ts:44:21)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:48:21)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.001, silenceTimeout: 20 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] MediaRecorder stopped

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:189:25)

    console.log
      [useVoiceRecorder] Audio chunks collected: 0

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:190:25)

    console.log
      [useVoiceRecorder] Not listening anymore, not restarting

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:211:29)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/wav

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:162:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/wav

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using browser default MIME type

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:166:25)

    console.log
      [useVoiceRecorder] Final MIME type: browser default

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

PASS __tests__/api/whatsapp-numbers.test.ts
  ● Console

    console.error
      [WhatsApp Numbers API] Error fetching numbers: Error: db failure
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/whatsapp-numbers.test.ts:119:39)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/whatsapp-numbers/route.ts:190:17)
      at Object.<anonymous> (__tests__/api/whatsapp-numbers.test.ts:122:24)

    console.error
      [WhatsApp Numbers API] Error creating number: Error: save error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/whatsapp-numbers.test.ts:308:57)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/whatsapp-numbers/route.ts:274:17)
      at Object.<anonymous> (__tests__/api/whatsapp-numbers.test.ts:324:24)

    console.error
      [WhatsApp Numbers API] Error updating number: Error: update error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/whatsapp-numbers.test.ts:428:62)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/whatsapp-numbers/route.ts:354:17)
      at Object.<anonymous> (__tests__/api/whatsapp-numbers.test.ts:435:24)

    console.error
      [WhatsApp Numbers API] Error deleting number: Error: delete error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/whatsapp-numbers.test.ts:513:62)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/whatsapp-numbers/route.ts:394:17)
      at Object.<anonymous> (__tests__/api/whatsapp-numbers.test.ts:516:24)

PASS __tests__/app/agents-page.fetch.test.tsx
  ● Console

    console.error
      Error fetching agent: TypeError: Cannot read properties of undefined (reading 'ok')
          at ok (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/agents/[id]/page.tsx:39:26)
          at runNextTicks (node:internal/process/task_queues:60:5)
          at listOnTimeout (node:internal/timers:545:9)
          at processTimers (node:internal/timers:519:7)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/agents/[id]/page.tsx:57:25)

    console.error
      Error fetching agent: TypeError: Cannot read properties of undefined (reading 'ok')
          at ok (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/agents/[id]/page.tsx:39:26)
          at runNextTicks (node:internal/process/task_queues:60:5)
          at listOnTimeout (node:internal/timers:545:9)
          at processTimers (node:internal/timers:519:7)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/agents/[id]/page.tsx:57:25)

    console.error
      Error fetching agent: TypeError: Cannot read properties of undefined (reading 'ok')
          at ok (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/agents/[id]/page.tsx:39:26)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/agents/[id]/page.tsx:57:25)

    console.error
      Error fetching agent: TypeError: Cannot read properties of undefined (reading 'ok')
          at ok (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/agents/[id]/page.tsx:39:26)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/agents/[id]/page.tsx:57:25)

PASS __tests__/app/agents-page.delete-navigation.test.tsx
PASS __tests__/api/upload-audio.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.error
      [upload-audio] No audio file provided in request

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/upload-audio.test.ts:32:24)

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.error
      [upload-audio] AssemblyAI API key not configured

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:22:21)
      at Object.<anonymous> (__tests__/api/upload-audio.test.ts:51:24)

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'test.webm', size: 0, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.error
      [upload-audio] Empty audio file received

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:35:21)
      at Object.<anonymous> (__tests__/api/upload-audio.test.ts:70:24)

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'test.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: https://example.com/audio.webm

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: undefined

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: transcript_123

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: completed

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Transcription completed successfully

      at log (app/api/upload-audio/route.ts:124:25)

    console.log
      [upload-audio] Transcribed text: Hello world

      at log (app/api/upload-audio/route.ts:125:25)

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'test.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: 500

      at log (app/api/upload-audio/route.ts:54:17)

    console.error
      [upload-audio] AssemblyAI upload failed: Upload failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:58:21)
      at Object.<anonymous> (__tests__/api/upload-audio.test.ts:143:24)

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'test.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: https://example.com/audio.webm

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: 500

      at log (app/api/upload-audio/route.ts:84:17)

    console.error
      [upload-audio] AssemblyAI transcription request failed: Transcription failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:88:21)
      at Object.<anonymous> (__tests__/api/upload-audio.test.ts:177:24)

PASS __tests__/api/campaign-contacts.test.ts
PASS __tests__/api/upload-audio.poll-error.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'test.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: https://example.com/audio.webm

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: undefined

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: transcript_123

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: error

      at log (app/api/upload-audio/route.ts:121:21)

    console.error
      [upload-audio] AssemblyAI transcription error: bad audio

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:131:25)
      at Object.<anonymous> (__tests__/api/upload-audio.poll-error.test.ts:54:17)

PASS __tests__/api/phone-numbers.test.ts
  ● Console

    console.log
      [Phone Numbers API] GET request received

      at log (app/api/phone-numbers/route.ts:56:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:63:17)

    console.log
      [Phone Numbers API] Found 2 phone numbers for user: user1

      at log (app/api/phone-numbers/route.ts:72:17)

    console.log
      [Phone Numbers API] GET request received

      at log (app/api/phone-numbers/route.ts:56:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:63:17)

    console.log
      [Phone Numbers API] Found 0 phone numbers for user: mukul

      at log (app/api/phone-numbers/route.ts:72:17)

    console.log
      [Phone Numbers API] GET request received

      at log (app/api/phone-numbers/route.ts:56:13)

    console.error
      [Phone Numbers API] Error fetching phone numbers: Error: DB error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/phone-numbers.test.ts:140:39)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:111:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:144:24)

    console.log
      [Phone Numbers API] GET request received

      at log (app/api/phone-numbers/route.ts:56:13)

    console.error
      [Phone Numbers API] Error fetching phone numbers: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:111:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:157:24)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: 'user1',
        phoneNumber: '+1234567890',
        provider: 'exotel',
        displayName: 'Test Phone',
        hasExotelConfig: true,
        linkedAgentId: 'agent1'
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.log
      [Phone Numbers API] Phone number saved successfully, ID: { toString: [Function: toString] }

      at log (app/api/phone-numbers/route.ts:189:17)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: undefined,
        phoneNumber: undefined,
        provider: undefined,
        displayName: undefined,
        hasExotelConfig: false,
        linkedAgentId: undefined
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.error
      [Phone Numbers API] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:151:21)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:211:24)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: undefined,
        phoneNumber: '+1234567890',
        provider: undefined,
        displayName: 'Test Phone',
        hasExotelConfig: false,
        linkedAgentId: undefined
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: undefined,
        phoneNumber: '+1555000111',
        provider: 'custom',
        displayName: 'Custom Provider',
        hasExotelConfig: true,
        linkedAgentId: undefined
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.log
      [Phone Numbers API] Phone number saved successfully, ID: { toString: [Function: toString] }

      at log (app/api/phone-numbers/route.ts:189:17)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: 'user1',
        phoneNumber: '+1234567890',
        provider: 'exotel',
        displayName: 'Test Phone',
        hasExotelConfig: false,
        linkedAgentId: 'agent1'
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.error
      [Phone Numbers API] Error creating phone number: Error: DB error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/phone-numbers.test.ts:275:54)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:210:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:289:24)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: 'user1',
        phoneNumber: '+1234567890',
        provider: 'exotel',
        displayName: 'Test Phone',
        hasExotelConfig: false,
        linkedAgentId: 'agent1'
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.error
      [Phone Numbers API] Error creating phone number: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:210:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:312:24)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: undefined,
        phoneNumber: '+1999888777',
        provider: 'twilio',
        displayName: 'Tech Line',
        hasExotelConfig: true,
        linkedAgentId: undefined
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.log
      [Phone Numbers API] Phone number saved successfully, ID: { toString: [Function: toString] }

      at log (app/api/phone-numbers/route.ts:189:17)

    console.log
      [Phone Numbers API] PUT request received

      at log (app/api/phone-numbers/route.ts:223:13)

    console.log
      [Phone Numbers API] Update request: {
        id: 'phone1',
        displayName: 'Updated Phone',
        hasExotelConfig: false,
        linkedAgentId: undefined,
        status: 'inactive'
      }

      at log (app/api/phone-numbers/route.ts:237:17)

    console.log
      [Phone Numbers API] Phone number updated successfully

      at log (app/api/phone-numbers/route.ts:271:17)

    console.log
      [Phone Numbers API] PUT request received

      at log (app/api/phone-numbers/route.ts:223:13)

    console.log
      [Phone Numbers API] Update request: {
        id: undefined,
        displayName: 'Test',
        hasExotelConfig: false,
        linkedAgentId: undefined,
        status: undefined
      }

      at log (app/api/phone-numbers/route.ts:237:17)

    console.log
      [Phone Numbers API] PUT request received

      at log (app/api/phone-numbers/route.ts:223:13)

    console.log
      [Phone Numbers API] Update request: {
        id: 'phone1',
        displayName: undefined,
        hasExotelConfig: true,
        linkedAgentId: 'agent-2',
        status: undefined
      }

      at log (app/api/phone-numbers/route.ts:237:17)

    console.log
      [Phone Numbers API] Phone number updated successfully

      at log (app/api/phone-numbers/route.ts:271:17)

    console.log
      [Phone Numbers API] PUT request received

      at log (app/api/phone-numbers/route.ts:223:13)

    console.log
      [Phone Numbers API] Update request: {
        id: 'nonexistent',
        displayName: undefined,
        hasExotelConfig: false,
        linkedAgentId: undefined,
        status: undefined
      }

      at log (app/api/phone-numbers/route.ts:237:17)

    console.log
      [Phone Numbers API] PUT request received

      at log (app/api/phone-numbers/route.ts:223:13)

    console.log
      [Phone Numbers API] Update request: {
        id: 'phone1',
        displayName: 'Updated Phone',
        hasExotelConfig: false,
        linkedAgentId: undefined,
        status: undefined
      }

      at log (app/api/phone-numbers/route.ts:237:17)

    console.error
      [Phone Numbers API] Error updating phone number: Error: DB error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/phone-numbers.test.ts:463:59)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:293:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:473:24)

    console.log
      [Phone Numbers API] PUT request received

      at log (app/api/phone-numbers/route.ts:223:13)

    console.log
      [Phone Numbers API] Update request: {
        id: 'phone1',
        displayName: 'Updated Phone',
        hasExotelConfig: false,
        linkedAgentId: undefined,
        status: undefined
      }

      at log (app/api/phone-numbers/route.ts:237:17)

    console.error
      [Phone Numbers API] Error updating phone number: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:293:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:491:24)

    console.log
      [Phone Numbers API] DELETE request received

      at log (app/api/phone-numbers/route.ts:306:13)

    console.log
      [Phone Numbers API] Phone number deleted successfully

      at log (app/api/phone-numbers/route.ts:330:17)

    console.log
      [Phone Numbers API] DELETE request received

      at log (app/api/phone-numbers/route.ts:306:13)

    console.log
      [Phone Numbers API] DELETE request received

      at log (app/api/phone-numbers/route.ts:306:13)

    console.log
      [Phone Numbers API] DELETE request received

      at log (app/api/phone-numbers/route.ts:306:13)

    console.error
      [Phone Numbers API] Error deleting phone number: Error: DB error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/phone-numbers.test.ts:544:59)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:338:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:550:24)

    console.log
      [Phone Numbers API] DELETE request received

      at log (app/api/phone-numbers/route.ts:306:13)

    console.error
      [Phone Numbers API] Error deleting phone number: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:338:17)
      at Object.<anonymous> (__tests__/api/phone-numbers.test.ts:564:24)

PASS __tests__/api/voice-agents.test.ts
  ● Console

    console.log
      [Voice Agents API] GET request received

      at log (app/api/voice-agents/route.ts:9:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:22:17)

    console.log
      [Voice Agents API] Found 2 agents for user: mukul

      at log (app/api/voice-agents/route.ts:29:17)

    console.log
      [Voice Agents API] GET request received

      at log (app/api/voice-agents/route.ts:9:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:22:17)

    console.log
      [Voice Agents API] Found 0 agents for user: mukul

      at log (app/api/voice-agents/route.ts:29:17)

    console.log
      [Voice Agents API] GET request received

      at log (app/api/voice-agents/route.ts:9:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:22:17)

    console.log
      [Voice Agents API] Found 0 agents for user: newuser

      at log (app/api/voice-agents/route.ts:29:17)

    console.log
      [Voice Agents API] GET request received

      at log (app/api/voice-agents/route.ts:9:13)

    console.error
      [Voice Agents API] Connection error, clearing cache and retrying...

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:18:21)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:131:24)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:22:17)

    console.log
      [Voice Agents API] Found 0 agents for user: mukul

      at log (app/api/voice-agents/route.ts:29:17)

    console.log
      [Voice Agents API] GET request received

      at log (app/api/voice-agents/route.ts:9:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:22:17)

    console.error
      [Voice Agents API] Error fetching agents: Error: Query failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/voice-agents.test.ts:145:43)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:50:17)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:151:24)

    console.log
      [Voice Agents API] POST request received

      at log (app/api/voice-agents/route.ts:64:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:68:17)

    console.log
      [Voice Agents API] Request data: {
        userId: 'testuser',
        title: 'New Agent',
        promptLength: 27,
        llmModel: 'Gemini 1.5 Pro',
        sttModel: 'AssemblyAI Best',
        ttsModel: 'Deepgram Aura Stella',
        knowledgeCount: 0
      }

      at log (app/api/voice-agents/route.ts:71:17)

    console.log
      [Voice Agents API] Agent saved successfully, ID: new-agent-id

      at log (app/api/voice-agents/route.ts:104:17)

    console.log
      [Voice Agents API] POST request received

      at log (app/api/voice-agents/route.ts:64:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:68:17)

    console.log
      [Voice Agents API] Request data: {
        userId: undefined,
        title: 'Minimal Agent',
        promptLength: 12,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 0
      }

      at log (app/api/voice-agents/route.ts:71:17)

    console.log
      [Voice Agents API] Agent saved successfully, ID: { toString: [Function: toString] }

      at log (app/api/voice-agents/route.ts:104:17)

    console.log
      [Voice Agents API] POST request received

      at log (app/api/voice-agents/route.ts:64:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:68:17)

    console.log
      [Voice Agents API] Request data: {
        userId: undefined,
        title: '  Spaced Agent  ',
        promptLength: 17,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 0
      }

      at log (app/api/voice-agents/route.ts:71:17)

    console.log
      [Voice Agents API] Agent saved successfully, ID: { toString: [Function: toString] }

      at log (app/api/voice-agents/route.ts:104:17)

    console.log
      [Voice Agents API] POST request received

      at log (app/api/voice-agents/route.ts:64:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:68:17)

    console.log
      [Voice Agents API] Request data: {
        userId: undefined,
        title: undefined,
        promptLength: 23,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 0
      }

      at log (app/api/voice-agents/route.ts:71:17)

    console.error
      [Voice Agents API] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:82:21)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:292:24)

    console.log
      [Voice Agents API] POST request received

      at log (app/api/voice-agents/route.ts:64:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:68:17)

    console.log
      [Voice Agents API] Request data: {
        userId: undefined,
        title: 'Has title but no prompt',
        promptLength: undefined,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 0
      }

      at log (app/api/voice-agents/route.ts:71:17)

    console.error
      [Voice Agents API] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:82:21)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:311:24)

    console.log
      [Voice Agents API] POST request received

      at log (app/api/voice-agents/route.ts:64:13)

    console.log
      [Voice Agents API] Connected to MongoDB

      at log (app/api/voice-agents/route.ts:68:17)

    console.log
      [Voice Agents API] Request data: {
        userId: undefined,
        title: 'Test',
        promptLength: 11,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 0
      }

      at log (app/api/voice-agents/route.ts:71:17)

    console.error
      [Voice Agents API] Error creating agent: Error: Database error
          at MockModel.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/voice-agents.test.ts:322:45)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at MockModel.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at MockModel.mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at new MockModel (eval at _createMockFunction (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:460:31), <anonymous>:3:55)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/voice-agents/route.ts:91:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/voice-agents.test.ts:331:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:123:17)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:331:24)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: 'agent-123',
        title: 'Updated Title',
        promptLength: 14,
        llmModel: 'Gemini 1.5 Pro',
        sttModel: 'AssemblyAI Best',
        ttsModel: 'Deepgram Aura Stella',
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.log
      [Voice Agents API] Agent updated successfully

      at log (app/api/voice-agents/route.ts:182:17)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: 'agent-123',
        title: 'Only Title Updated',
        promptLength: undefined,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.log
      [Voice Agents API] Agent updated successfully

      at log (app/api/voice-agents/route.ts:182:17)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: 'agent-123',
        title: '  Spaced Title  ',
        promptLength: 17,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.log
      [Voice Agents API] Agent updated successfully

      at log (app/api/voice-agents/route.ts:182:17)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: undefined,
        title: 'Updated Title',
        promptLength: undefined,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: 'agent-123',
        title: undefined,
        promptLength: undefined,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: 'non-existent',
        title: 'Update',
        promptLength: undefined,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.log
      [Voice Agents API] PUT request received

      at log (app/api/voice-agents/route.ts:136:13)

    console.log
      [Voice Agents API] Update request: {
        id: 'agent-123',
        title: 'Update',
        promptLength: undefined,
        llmModel: undefined,
        sttModel: undefined,
        ttsModel: undefined,
        knowledgeCount: 'unchanged'
      }

      at log (app/api/voice-agents/route.ts:142:17)

    console.error
      [Voice Agents API] Error updating agent: Error: Update failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/voice-agents.test.ts:521:70)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:201:17)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:528:24)

    console.log
      [Voice Agents API] DELETE request received

      at log (app/api/voice-agents/route.ts:214:13)

    console.log
      [Voice Agents API] Agent deleted successfully

      at log (app/api/voice-agents/route.ts:238:17)

    console.log
      [Voice Agents API] DELETE request received

      at log (app/api/voice-agents/route.ts:214:13)

    console.log
      [Voice Agents API] DELETE request received

      at log (app/api/voice-agents/route.ts:214:13)

    console.log
      [Voice Agents API] DELETE request received

      at log (app/api/voice-agents/route.ts:214:13)

    console.error
      [Voice Agents API] Error deleting agent: Error: Deletion failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/voice-agents.test.ts:589:70)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/route.ts:246:17)
      at Object.<anonymous> (__tests__/api/voice-agents.test.ts:593:24)

PASS __tests__/api/upload-audio.extra.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'a.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: u

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: undefined

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: id1

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: error

      at log (app/api/upload-audio/route.ts:121:21)

    console.error
      [upload-audio] AssemblyAI transcription error: bad

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:131:25)
      at Object.<anonymous> (__tests__/api/upload-audio.extra.test.ts:30:17)

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'a.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: u

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: undefined

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: id1

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 1000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 2/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 1500ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 3/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 2250ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 4/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 3375ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 5/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 6/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 7/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 8/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 9/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 10/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 11/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 12/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 13/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 14/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 15/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 16/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 17/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 18/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 19/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 20/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 21/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 22/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 23/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 24/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 25/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 26/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 27/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 28/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 29/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 30/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 31/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 32/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 33/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 34/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 35/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 36/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 37/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 38/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 39/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 40/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 41/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 42/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 43/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 44/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 45/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 46/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 47/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 48/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 49/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 50/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 51/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 52/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 53/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 54/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 55/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 56/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 57/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 58/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 59/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 60/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.error
      [upload-audio] Transcription timeout after 60 attempts

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:142:17)

PASS __tests__/api/campaigns.start.test.ts (8.519 s)
  ● Console

    console.error
      Error starting campaign: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
          at JSON.parse (<anonymous>)
          at POST (app/api/campaigns/start/route.ts:15:22)
          at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:60:22)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:81:17)
      at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:60:22)

    console.error
      Error starting campaign: Error: Save failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:173:41)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:81:17)
      at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:186:22)

    console.error
      Error starting campaign: Error: DB connection failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:268:37)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:81:17)
      at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:275:22)

    console.error
      Error calling contact 1234567890: Error: Save failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:318:47)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:138:21)

    console.log
      Campaign contact_save_fail completed. Success: 0, Failed: 1

      at log (app/api/campaigns/start/route.ts:161:13)

    console.error
      Error calling contact 1234567890: Error: Update failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:348:54)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:138:21)

    console.error
      Error in background call processing: Error: Update failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:348:54)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:67:21)

    console.log
      Campaign running_no_started_at completed. Success: 1, Failed: 0

      at log (app/api/campaigns/start/route.ts:161:13)

    console.log
      Campaign running_no_started_at completed. Success: 1, Failed: 0

      at log (app/api/campaigns/start/route.ts:161:13)

    console.log
      Campaign success_campaign completed. Success: 1, Failed: 0

      at log (app/api/campaigns/start/route.ts:161:13)

    console.log
      Campaign exotel_fail completed. Success: 0, Failed: 1

      at log (app/api/campaigns/start/route.ts:161:13)

    console.error
      Error calling contact 1111111111: TypeError: contact.save is not a function
          at save (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/campaigns/start/route.ts:103:27)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:138:21)

    console.error
      Error in background call processing: TypeError: contact.save is not a function
          at save (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/campaigns/start/route.ts:145:27)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:67:21)

    console.log
      Campaign campaign123 completed. Success: 2, Failed: 0

      at log (app/api/campaigns/start/route.ts:161:13)

    console.log
      Campaign campaign123 completed. Success: 0, Failed: 1

      at log (app/api/campaigns/start/route.ts:161:13)

    console.error
      Error calling contact +1234567890: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:510:45)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:138:21)
      at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:512:5)

    console.log
      Campaign campaign123 completed. Success: 0, Failed: 1

      at log (app/api/campaigns/start/route.ts:161:13)

    console.error
      Error calling contact +0987654321: Error: Network error
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:561:31
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13
          at mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at triggerCampaignCalls (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/campaigns/start/route.ts:106:51)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.start.test.ts:565:5)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:138:21)
      at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:565:5)

    console.log
      Campaign campaign123 completed. Success: 1, Failed: 1

      at log (app/api/campaigns/start/route.ts:161:13)

    console.log
      Campaign campaign123 completed. Success: 0, Failed: 0

      at log (app/api/campaigns/start/route.ts:161:13)

    console.error
      Error calling contact +1234567890: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/start/route.ts:138:21)
      at Object.<anonymous> (__tests__/api/campaigns.start.test.ts:608:5)

    console.log
      Campaign campaign123 completed. Success: 0, Failed: 1

      at log (app/api/campaigns/start/route.ts:161:13)

PASS __tests__/api/generate-pdf.test.ts
  ● Console

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.error
      [generate-pdf] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/generate-pdf/route.ts:29:21)
      at Object.<anonymous> (__tests__/api/generate-pdf.test.ts:14:22)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: My Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Table Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Unknown Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.error
      [generate-pdf] Unknown section type: unknown

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/generate-pdf/route.ts:156:25)
      at Object.<anonymous> (__tests__/api/generate-pdf.test.ts:61:22)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.error
      [generate-pdf] Error generating PDF: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
          at JSON.parse (<anonymous>)
          at POST (app/api/generate-pdf/route.ts:26:47)
          at Object.<anonymous> (__tests__/api/generate-pdf.test.ts:69:22)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/generate-pdf/route.ts:186:17)
      at Object.<anonymous> (__tests__/api/generate-pdf.test.ts:69:22)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Empty Table Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Error Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.error
      [generate-pdf] Error generating PDF: Error: PDF generation failed
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/generate-pdf.test.ts:93:13)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/generate-pdf/route.ts:39:21)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/generate-pdf.test.ts:103:22)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/generate-pdf/route.ts:186:17)
      at Object.<anonymous> (__tests__/api/generate-pdf.test.ts:103:22)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: String Error Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.error
      [generate-pdf] Error generating PDF: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/generate-pdf/route.ts:186:17)
      at Object.<anonymous> (__tests__/api/generate-pdf.test.ts:124:22)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Page Break Test

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Multi Section Doc

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: Heading Levels Test

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

    console.log
      [generate-pdf] POST request received

      at log (app/api/generate-pdf/route.ts:23:13)

    console.log
      [generate-pdf] Generating PDF: List Test

      at log (app/api/generate-pdf/route.ts:36:17)

    console.log
      [generate-pdf] PDF generated successfully

      at log (app/api/generate-pdf/route.ts:177:17)

PASS __tests__/api/campaigns.test.ts
PASS __tests__/api/upload-audio.status-error.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'a.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: u

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: undefined

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: id1

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.error
      [upload-audio] AssemblyAI status check failed: bad status

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:116:25)
      at Object.<anonymous> (__tests__/api/upload-audio.status-error.test.ts:28:17)

PASS __tests__/api/llm.outer-catch-mapping.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.error
      [LLM] LLM API error: Error: Invalid API_KEY provided
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:25:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:26:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:319:17)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:26:17)

    console.error
      [LLM] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:323:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:26:17)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:328:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:26:17)

    console.error
      [LLM] Error message: Invalid API_KEY provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:329:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:26:17)

    console.error
      [LLM] Error stack: Error: Invalid API_KEY provided
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:25:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:26:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:330:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:26:17)

    console.error
      [LLM] Invalid or missing API key detected

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:333:25)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:26:17)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.error
      [LLM] LLM API error: Error: Blocked by SAFETY policy
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:31:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:32:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:319:17)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:32:17)

    console.error
      [LLM] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:323:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:32:17)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:328:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:32:17)

    console.error
      [LLM] Error message: Blocked by SAFETY policy

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:329:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:32:17)

    console.error
      [LLM] Error stack: Error: Blocked by SAFETY policy
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:31:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:32:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:330:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:32:17)

    console.error
      [LLM] Content filtered by safety policies

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:337:25)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:32:17)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.error
      [LLM] LLM API error: Error: quota exceeded
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:37:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:38:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:319:17)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:38:17)

    console.error
      [LLM] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:323:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:38:17)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:328:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:38:17)

    console.error
      [LLM] Error message: quota exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:329:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:38:17)

    console.error
      [LLM] Error stack: Error: quota exceeded
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:37:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:38:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:330:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:38:17)

    console.error
      [LLM] API quota exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:341:25)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:38:17)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.error
      [LLM] LLM API error: Error: 404 Not Found
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:43:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:44:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:319:17)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:44:17)

    console.error
      [LLM] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:323:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:44:17)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:328:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:44:17)

    console.error
      [LLM] Error message: 404 Not Found

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:329:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:44:17)

    console.error
      [LLM] Error stack: Error: 404 Not Found
          at Object.json (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:43:54)
          at json (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:50:84)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.outer-catch-mapping.test.ts:44:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:330:21)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:44:17)

    console.error
      [LLM] Model not found or invalid API key

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:345:25)
      at Object.<anonymous> (__tests__/api/llm.outer-catch-mapping.test.ts:44:17)

PASS __tests__/hooks/useSpeechRecognition.test.tsx
PASS __tests__/api/telephony-webhook.test.ts
  ● Console

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.log
      [Exotel Webhook] Received data: {
        CallSid: 'call123',
        From: '+1234567890',
        To: '+0987654321',
        Status: 'ringing'
      }

      at log (app/api/telephony/webhook/[phoneId]/route.ts:51:17)

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.log
      [Exotel Webhook] Received data: {
        CallSid: 'call456',
        From: '+1111111111',
        To: '+2222222222',
        Status: 'in-progress'
      }

      at log (app/api/telephony/webhook/[phoneId]/route.ts:51:17)

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.log
      [Exotel Webhook] Received data: {
        CallSid: 'call123',
        From: undefined,
        To: undefined,
        Status: undefined
      }

      at log (app/api/telephony/webhook/[phoneId]/route.ts:51:17)

    console.error
      [Exotel Webhook] Phone number not found for ID: test-phone-123

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/telephony/webhook/[phoneId]/route.ts:69:21)
      at Object.<anonymous> (__tests__/api/telephony-webhook.test.ts:146:24)

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.log
      [Exotel Webhook] Received data: {
        CallSid: 'call123',
        From: '+1234567890',
        To: '+0987654321',
        Status: 'ringing'
      }

      at log (app/api/telephony/webhook/[phoneId]/route.ts:51:17)

    console.warn
      [Exotel Webhook] No agent linked to phone number

      86 |         if (!agent) {
      87 |             // If no agent linked, use a default agent or return error
    > 88 |             console.warn('[Exotel Webhook] No agent linked to phone number');
         |                     ^
      89 |             agent = await VoiceAgent.findOne({ userId: phoneNumber.userId }).sort({ createdAt: -1 });
      90 |         }
      91 |

      at warn (app/api/telephony/webhook/[phoneId]/route.ts:88:21)
      at Object.<anonymous> (__tests__/api/telephony-webhook.test.ts:183:24)

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.log
      [Exotel Webhook] Received data: {
        CallSid: 'call123',
        From: '+1234567890',
        To: '+0987654321',
        Status: 'ringing'
      }

      at log (app/api/telephony/webhook/[phoneId]/route.ts:51:17)

    console.warn
      [Exotel Webhook] No agent linked to phone number

      86 |         if (!agent) {
      87 |             // If no agent linked, use a default agent or return error
    > 88 |             console.warn('[Exotel Webhook] No agent linked to phone number');
         |                     ^
      89 |             agent = await VoiceAgent.findOne({ userId: phoneNumber.userId }).sort({ createdAt: -1 });
      90 |         }
      91 |

      at warn (app/api/telephony/webhook/[phoneId]/route.ts:88:21)
      at Object.<anonymous> (__tests__/api/telephony-webhook.test.ts:214:24)

    console.error
      [Exotel Webhook] No agent available

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/telephony/webhook/[phoneId]/route.ts:93:21)
      at Object.<anonymous> (__tests__/api/telephony-webhook.test.ts:214:24)

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.error
      [Exotel Webhook] Error handling webhook: Error: DB error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/telephony-webhook.test.ts:222:39)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/telephony/webhook/[phoneId]/route.ts:125:17)
      at Object.<anonymous> (__tests__/api/telephony-webhook.test.ts:229:24)

    console.log
      [Exotel Webhook] Incoming call for phone ID: test-phone-123

      at log (app/api/telephony/webhook/[phoneId]/route.ts:35:13)

    console.log
      [Exotel Webhook] Received data: {
        CallSid: 'call123',
        From: '+1234567890',
        To: '+0987654321',
        Status: 'ringing'
      }

      at log (app/api/telephony/webhook/[phoneId]/route.ts:51:17)

PASS __tests__/app/agents-page.branches.test.tsx
PASS __tests__/api/upload-audio.timeout.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'test.webm', size: 15, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 15 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: undefined

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: https://example.com/audio.webm

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: undefined

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: transcript_123

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 1000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 2/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 1500ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 3/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 2250ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 4/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 3375ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 5/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 6/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 7/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 8/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 9/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 10/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 11/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 12/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 13/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 14/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 15/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 16/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 17/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 18/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 19/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 20/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 21/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 22/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 23/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 24/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 25/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 26/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 27/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 28/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 29/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 30/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 31/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 32/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 33/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 34/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 35/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 36/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 37/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 38/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 39/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 40/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 41/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 42/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 43/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 44/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 45/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 46/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 47/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 48/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 49/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 50/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 51/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 52/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 53/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 54/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 55/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 56/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 57/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 58/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 59/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 60/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: undefined

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: queued

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.error
      [upload-audio] Transcription timeout after 60 attempts

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:142:17)

PASS __tests__/app/dashboard.start-campaign.test.tsx
PASS __tests__/hooks/useVoiceRecorder.extra.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 10 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 10 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Data available, size: 3 bytes

      at Object.log [as ondataavailable] (hooks/useVoiceRecorder.ts:182:25)

    console.log
      [useVoiceRecorder] Silence timeout reached, stopping segment

      at log (hooks/useVoiceRecorder.ts:94:29)

    console.log
      [useVoiceRecorder] stopSegment called

      at log (hooks/useVoiceRecorder.ts:38:17)

    console.log
      [useVoiceRecorder] Stopping MediaRecorder...

      at log (hooks/useVoiceRecorder.ts:41:21)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:48:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] MediaRecorder stopped

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:189:25)

    console.log
      [useVoiceRecorder] Audio chunks collected: 1

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:190:25)

    console.log
      [useVoiceRecorder] Created audio blob, size: 3 bytes

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:194:29)

    console.log
      [useVoiceRecorder] Calling onSegmentReady callback...

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:195:29)

    console.log
      [useVoiceRecorder] Still listening, restarting MediaRecorder in 10ms...

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:203:29)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 10 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Silence timeout reached, stopping segment

      at log (hooks/useVoiceRecorder.ts:94:29)

    console.log
      [useVoiceRecorder] stopSegment called

      at log (hooks/useVoiceRecorder.ts:38:17)

    console.log
      [useVoiceRecorder] Stopping MediaRecorder...

      at log (hooks/useVoiceRecorder.ts:41:21)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:48:21)

    console.log
      [useVoiceRecorder] Restarting MediaRecorder...

      at log (hooks/useVoiceRecorder.ts:206:37)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping MediaRecorder...

      at log (hooks/useVoiceRecorder.ts:251:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

PASS __tests__/api/voice-agents-id.test.ts
  ● Console

    console.error
      [GET /api/voice-agents/[id]] Error: Error: Database error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/voice-agents-id.test.ts:85:61)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/voice-agents/[id]/route.ts:45:17)
      at Object.<anonymous> (__tests__/api/voice-agents-id.test.ts:90:24)

PASS __tests__/api/chat-sessions.test.ts
  ● Console

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: testuser

      at log (app/api/chat/sessions/route.ts:13:17)

    console.log
      [Sessions API] Found 2 sessions for user: testuser

      at log (app/api/chat/sessions/route.ts:64:17)

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: mukul

      at log (app/api/chat/sessions/route.ts:13:17)

    console.log
      [Sessions API] Found 0 sessions for user: mukul

      at log (app/api/chat/sessions/route.ts:64:17)

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: newuser

      at log (app/api/chat/sessions/route.ts:13:17)

    console.log
      [Sessions API] Found 0 sessions for user: newuser

      at log (app/api/chat/sessions/route.ts:64:17)

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: mukul

      at log (app/api/chat/sessions/route.ts:13:17)

    console.error
      [Sessions API] Connection error, clearing cache and retrying...

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/sessions/route.ts:19:21)
      at Object.<anonymous> (__tests__/api/chat-sessions.test.ts:100:24)

    console.log
      [Sessions API] Found 0 sessions for user: mukul

      at log (app/api/chat/sessions/route.ts:64:17)

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: testuser

      at log (app/api/chat/sessions/route.ts:13:17)

    console.log
      [Sessions API] Found 0 sessions for user: testuser

      at log (app/api/chat/sessions/route.ts:64:17)

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: mukul

      at log (app/api/chat/sessions/route.ts:13:17)

    console.error
      [Sessions API] Error fetching sessions: Error: Aggregation failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/chat-sessions.test.ts:149:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/sessions/route.ts:74:17)
      at Object.<anonymous> (__tests__/api/chat-sessions.test.ts:153:24)

    console.log
      [Sessions API] GET request received

      at log (app/api/chat/sessions/route.ts:6:13)

    console.log
      [Sessions API] Fetching sessions for userId: mukul

      at log (app/api/chat/sessions/route.ts:13:17)

    console.error
      [Sessions API] Error fetching sessions: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/sessions/route.ts:74:17)
      at Object.<anonymous> (__tests__/api/chat-sessions.test.ts:168:24)

PASS __tests__/api/llm.extract-and-errors.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["candidates"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: from-candidates

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 15

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["output"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: nested-text

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 11

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: { status: 403, response: { data: 'Forbidden' } }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:79:17)

    console.log
      [LLM] Error status: 403 body: Forbidden

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] LLM HTTP status: 403 body: Forbidden

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:274:25)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:79:17)

    console.error
      [LLM] Authentication error: 403

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:281:29)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:79:17)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: boom
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.extract-and-errors.test.ts:87:54)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.extract-and-errors.test.ts:92:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:92:17)

    console.log
      [LLM] Error status: null body: boom

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:92:17)

    console.error
      [LLM] Error message: boom

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:92:17)

    console.error
      [LLM] Error stack: Error: boom
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.extract-and-errors.test.ts:87:54)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at mockConstructor.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at new mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:108:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.extract-and-errors.test.ts:92:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:92:17)

    console.error
      [LLM] Returning generic generate error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:314:21)
      at Object.<anonymous> (__tests__/api/llm.extract-and-errors.test.ts:92:17)

PASS __tests__/hooks/useVoiceRecorder.errors-and-restart.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.error
      [useVoiceRecorder] Error starting recording: Error: denied
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/hooks/useVoiceRecorder.errors-and-restart.test.tsx:11:23)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error [as startRecording] (hooks/useVoiceRecorder.ts:236:21)
      at __tests__/hooks/useVoiceRecorder.errors-and-restart.test.tsx:20:9

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Data available, size: 4 bytes

      at Object.log [as ondataavailable] (hooks/useVoiceRecorder.ts:182:25)

    console.log
      [useVoiceRecorder] MediaRecorder stopped

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:189:25)

    console.log
      [useVoiceRecorder] Audio chunks collected: 1

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:190:25)

    console.log
      [useVoiceRecorder] Created audio blob, size: 4 bytes

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:194:29)

    console.log
      [useVoiceRecorder] Calling onSegmentReady callback...

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:195:29)

    console.log
      [useVoiceRecorder] Still listening, restarting MediaRecorder in 10ms...

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:203:29)

    console.log
      [useVoiceRecorder] Restarting MediaRecorder...

      at log (hooks/useVoiceRecorder.ts:206:37)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Stopping MediaRecorder...

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:251:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

PASS __tests__/api/chat-save.test.ts
  ● Console

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: 'testuser', sessionId: 'session-123', messagesLength: 5 }

      at log (app/api/chat/save/route.ts:13:17)

    console.log
      [Chat Save] Session chat saved successfully, ID: chat-id-123

      at log (app/api/chat/save/route.ts:46:17)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: 'session-123', messagesLength: 1 }

      at log (app/api/chat/save/route.ts:13:17)

    console.log
      [Chat Save] Session chat saved successfully, ID: test-id

      at log (app/api/chat/save/route.ts:46:17)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: undefined, messagesLength: 1 }

      at log (app/api/chat/save/route.ts:13:17)

    console.error
      [Chat Save] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/save/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/chat-save.test.ts:109:24)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: 'session-123', messagesLength: 0 }

      at log (app/api/chat/save/route.ts:13:17)

    console.error
      [Chat Save] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/save/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/chat-save.test.ts:129:24)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: 'session-123', messagesLength: 1 }

      at log (app/api/chat/save/route.ts:13:17)

    console.error
      [Chat Save] No valid user/assistant messages to save

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/save/route.ts:29:21)
      at Object.<anonymous> (__tests__/api/chat-save.test.ts:151:24)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: 'session-123', messagesLength: 1 }

      at log (app/api/chat/save/route.ts:13:17)

    console.error
      [Chat Save] Error saving chat: Error: Save failed
          at MockModel.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/chat-save.test.ts:162:45)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:295:43
          at MockModel.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at MockModel.mockConstructor (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at new MockModel (eval at _createMockFunction (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:460:31), <anonymous>:3:55)
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/chat/save/route.ts:37:22)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/chat-save.test.ts:176:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/save/route.ts:55:17)
      at Object.<anonymous> (__tests__/api/chat-save.test.ts:176:24)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: 'session-123', messagesLength: 12 }

      at log (app/api/chat/save/route.ts:13:17)

    console.error
      [Chat Save] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/save/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/chat-save.test.ts:197:24)

    console.log
      [Chat Save] POST request received

      at log (app/api/chat/save/route.ts:6:13)

    console.log
      [Chat Save] Connected to MongoDB

      at log (app/api/chat/save/route.ts:10:17)

    console.log
      [Chat Save] Request data: { userId: undefined, sessionId: 'session-123', messagesLength: 1 }

      at log (app/api/chat/save/route.ts:13:17)

    console.error
      [Chat Save] Error saving chat: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/save/route.ts:55:17)
      at Object.<anonymous> (__tests__/api/chat-save.test.ts:222:24)

PASS __tests__/api/llm.route.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: '   ',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.error
      [LLM] No user text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:60:21)
      at Object.<anonymous> (__tests__/api/llm.route.test.ts:36:22)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.error
      [LLM] Gemini API key not configured

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:99:21)
      at Object.<anonymous> (__tests__/api/llm.route.test.ts:45:22)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: true,
        promptLength: 3,
        userText: 'Hi',
        sessionId: undefined,
        historyLength: 3
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 4 Save to history: true

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] User message saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:88:25)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 3

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 3 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 69

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): sys
      
      ## Previous Conversation:
      User: a
      Assistant: b
      User: c
      
      User: Hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: Hello from LLM

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Hello from LLM

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 14

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Assistant response saved to database (conversation has >2 messages)

      at log (app/api/llm/route.ts:223:29)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: 0,
        userText: 'Hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generate method

      at log (app/api/llm/route.ts:186:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["output"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: gen-output

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 10

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.error
      [LLM] Error while calling model.generate/generateContent: { status: 404, response: { data: 'not found' } }

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.route.test.ts:86:22)

    console.log
      [LLM] Error status: 404 body: not found

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] LLM HTTP status: 404 body: not found

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:274:25)
      at Object.<anonymous> (__tests__/api/llm.route.test.ts:86:22)

    console.error
      [LLM] Model or endpoint not found (404)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:277:29)
      at Object.<anonymous> (__tests__/api/llm.route.test.ts:86:22)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: Result text <<<PDF>>>{"title":"My PDF"}<<</PDF>>> remainder

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Result text <<<PDF>>>{"title":"My PDF"}<<</PDF>>> remainder

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 59

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] PDF command detected in response

      at log (app/api/llm/route.ts:241:29)

    console.log
      [LLM] PDF command extracted: My PDF

      at log (app/api/llm/route.ts:246:29)

PASS __tests__/api/upload-audio.catch-error.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.error
      [upload-audio] Unexpected error: Error: boom
          at NextRequest.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/upload-audio.catch-error.test.ts:17:42)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at NextRequest.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at NextRequest.mockConstructor [as formData] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at formData (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/upload-audio/route.ts:12:40)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/upload-audio.catch-error.test.ts:19:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:146:17)
      at Object.<anonymous> (__tests__/api/upload-audio.catch-error.test.ts:19:27)

    console.error
      [upload-audio] Error message: boom

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:148:21)
      at Object.<anonymous> (__tests__/api/upload-audio.catch-error.test.ts:19:27)

    console.error
      [upload-audio] Error stack: Error: boom
          at NextRequest.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/upload-audio.catch-error.test.ts:17:42)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at NextRequest.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at NextRequest.mockConstructor [as formData] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at formData (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/upload-audio/route.ts:12:40)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/upload-audio.catch-error.test.ts:19:27)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:149:21)
      at Object.<anonymous> (__tests__/api/upload-audio.catch-error.test.ts:19:27)

PASS __tests__/api/llm.extra.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generate method

      at log (app/api/llm/route.ts:186:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: from-generate

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 13

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generate method

      at log (app/api/llm/route.ts:186:25)

    console.log
      [LLM] Retrying generate with direct string parameter

      at log (app/api/llm/route.ts:191:29)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: retry-ok

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.error
      [LLM] Could not initialize gemini-2.0-flash, attempting fallback model (gemini-pro). no flash

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:117:21)
      at Object.<anonymous> (__tests__/api/llm.extra.test.ts:108:17)

    console.log
      [LLM] Using fallback model: gemini-pro

      at log (app/api/llm/route.ts:120:25)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: fallback-ok

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 11

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.error
      [LLM] Could not initialize gemini-2.0-flash, attempting fallback model (gemini-pro). no model

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:117:21)
      at Object.<anonymous> (__tests__/api/llm.extra.test.ts:126:17)

    console.error
      [LLM] Failed to initialize any supported model: Error: no model
          at Object.bad (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.extra.test.ts:116:31)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as getGenerativeModel] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at getGenerativeModel (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:119:31)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.extra.test.ts:126:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:122:25)
      at Object.<anonymous> (__tests__/api/llm.extra.test.ts:126:17)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview:

      at log (app/api/llm/route.ts:204:21)

    console.error
      [LLM] Received empty response from LLM

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:207:25)
      at Object.<anonymous> (__tests__/api/llm.extra.test.ts:143:17)

PASS __tests__/api/tts.test.ts
  ● Console

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert:

      at log (app/api/tts/route.ts:13:17)

    console.error
      [TTS] No text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:32:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello world

      at log (app/api/tts/route.ts:13:17)

    console.error
      [TTS] Sarvam API key not configured

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:22:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:47:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello world

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 11 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 200

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.log
      [TTS] Parsing Sarvam response...

      at log (app/api/tts/route.ts:60:17)

    console.log
      [TTS] Sarvam response structure: [ 'audios' ]

      at log (app/api/tts/route.ts:62:17)

    console.log
      [TTS] Base64 audio length: 16 characters

      at log (app/api/tts/route.ts:71:17)

    console.log
      [TTS] Returning audio data

      at log (app/api/tts/route.ts:73:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello world

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 11 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 500

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.error
      [TTS] Sarvam TTS failed: TTS generation failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:55:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:100:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert:

      at log (app/api/tts/route.ts:13:17)

    console.error
      [TTS] No text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:115:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 5000 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 200

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.log
      [TTS] Parsing Sarvam response...

      at log (app/api/tts/route.ts:60:17)

    console.log
      [TTS] Sarvam response structure: [ 'audios' ]

      at log (app/api/tts/route.ts:62:17)

    console.log
      [TTS] Base64 audio length: 16 characters

      at log (app/api/tts/route.ts:71:17)

    console.log
      [TTS] Returning audio data

      at log (app/api/tts/route.ts:73:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello! @#$%^&*() नमस्ते

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 23 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 200

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.log
      [TTS] Parsing Sarvam response...

      at log (app/api/tts/route.ts:60:17)

    console.log
      [TTS] Sarvam response structure: [ 'audios' ]

      at log (app/api/tts/route.ts:62:17)

    console.log
      [TTS] Base64 audio length: 16 characters

      at log (app/api/tts/route.ts:71:17)

    console.log
      [TTS] Returning audio data

      at log (app/api/tts/route.ts:73:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Line 1
      Line 2
      Line 3

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 20 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 200

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.log
      [TTS] Parsing Sarvam response...

      at log (app/api/tts/route.ts:60:17)

    console.log
      [TTS] Sarvam response structure: [ 'audios' ]

      at log (app/api/tts/route.ts:62:17)

    console.log
      [TTS] Base64 audio length: 16 characters

      at log (app/api/tts/route.ts:71:17)

    console.log
      [TTS] Returning audio data

      at log (app/api/tts/route.ts:73:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Test text

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 9 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 200

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.log
      [TTS] Parsing Sarvam response...

      at log (app/api/tts/route.ts:60:17)

    console.log
      [TTS] Sarvam response structure: [ 'audios' ]

      at log (app/api/tts/route.ts:62:17)

    console.log
      [TTS] Base64 audio length: 16 characters

      at log (app/api/tts/route.ts:71:17)

    console.log
      [TTS] Returning audio data

      at log (app/api/tts/route.ts:73:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello world

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 11 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.test.ts:241:58)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.test.ts:248:24)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:248:24)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:248:24)

    console.error
      [TTS] Error message: Network error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:248:24)

    console.error
      [TTS] Error stack: Error: Network error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.test.ts:241:58)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:248:24)

    console.error
      [TTS] Returning generic service error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:107:17)
      at Object.<anonymous> (__tests__/api/tts.test.ts:248:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello world

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 11 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 401

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.error
      [TTS] Sarvam TTS failed: Unauthorized

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:55:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:272:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello world

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 11 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 429

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.error
      [TTS] Sarvam TTS failed: Rate limit exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:55:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:296:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.error
      [TTS] TTS API error: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
          at JSON.parse (<anonymous>)
          at POST (app/api/tts/route.ts:12:26)
          at Object.<anonymous> (__tests__/api/tts.test.ts:313:24)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.test.ts:313:24)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:313:24)

    console.error
      [TTS] Returning generic service error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:107:17)
      at Object.<anonymous> (__tests__/api/tts.test.ts:313:24)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: undefined

      at log (app/api/tts/route.ts:13:17)

    console.error
      [TTS] No text provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:16:21)
      at Object.<anonymous> (__tests__/api/tts.test.ts:325:24)

PASS __tests__/lib/whatsAppService.internals.test.ts
PASS __tests__/lib/voiceAgentPipeline.test.ts
PASS __tests__/hooks/useVoiceRecorder.silence-stop.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 50 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 50 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 50 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Silence timeout reached, stopping segment

      at log (hooks/useVoiceRecorder.ts:94:29)

    console.log
      [useVoiceRecorder] stopSegment called

      at log (hooks/useVoiceRecorder.ts:38:17)

    console.log
      [useVoiceRecorder] Stopping MediaRecorder...

      at log (hooks/useVoiceRecorder.ts:41:21)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:48:21)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Stopping MediaRecorder...

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:251:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 50 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

PASS __tests__/hooks/useVoiceRecorder.onstop-norestart.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] stopRecording called

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at Object.log [as stopRecording] (hooks/useVoiceRecorder.ts:283:17)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] MediaRecorder stopped

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:189:25)

    console.log
      [useVoiceRecorder] Audio chunks collected: 0

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:190:25)

    console.log
      [useVoiceRecorder] Not listening anymore, not restarting

      at Object.log [as onstop] (hooks/useVoiceRecorder.ts:211:29)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

PASS __tests__/api/meta-webhook.test.ts
  ● Console

    console.log
      WEBHOOK VERIFIED

      at log (app/api/meta-webhook/route.ts:29:21)

    console.log
      {"object":"whatsapp_business_account","entry":[]}

      at log (app/api/meta-webhook/route.ts:8:17)

    console.log
      invalid json

      at log (app/api/meta-webhook/route.ts:8:17)

    console.error
      Exception while metaMetlifeCallback Unexpected token 'i', "invalid json" is not valid JSON

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/meta-webhook/route.ts:15:17)
      at Object.<anonymous> (__tests__/api/meta-webhook.test.ts:103:24)

    console.log
      {"object":"whatsapp_business_account","entry":[]}

      at log (app/api/meta-webhook/route.ts:8:17)

    console.error
      Exception while metaMetlifeCallback Processing failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/meta-webhook/route.ts:15:17)
      at Object.<anonymous> (__tests__/api/meta-webhook.test.ts:120:24)

PASS __tests__/api/chat-history.test.ts
  ● Console

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.log
      [Chat History] Fetching chats for session: session-123

      at log (app/api/chat/history/route.ts:26:17)

    console.log
      [Chat History] Found 2 chats

      at log (app/api/chat/history/route.ts:35:17)

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.log
      [Chat History] Fetching chats for session: session-123

      at log (app/api/chat/history/route.ts:26:17)

    console.log
      [Chat History] Found 0 chats

      at log (app/api/chat/history/route.ts:35:17)

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.error
      [Chat History] No sessionId provided

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/history/route.ts:19:21)
      at Object.<anonymous> (__tests__/api/chat-history.test.ts:93:24)

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.log
      [Chat History] Fetching chats for session: empty-session

      at log (app/api/chat/history/route.ts:26:17)

    console.log
      [Chat History] Found 0 chats

      at log (app/api/chat/history/route.ts:35:17)

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.log
      [Chat History] Fetching chats for session: session-123

      at log (app/api/chat/history/route.ts:26:17)

    console.error
      [Chat History] Error fetching chat history: Error: Database error
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/chat-history.test.ts:131:43)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/history/route.ts:51:17)
      at Object.<anonymous> (__tests__/api/chat-history.test.ts:137:24)

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.log
      [Chat History] Fetching chats for session: session-123

      at log (app/api/chat/history/route.ts:26:17)

    console.log
      [Chat History] Found 0 chats

      at log (app/api/chat/history/route.ts:35:17)

    console.log
      [Chat History] GET request received

      at log (app/api/chat/history/route.ts:7:13)

    console.log
      [Chat History] Connected to MongoDB

      at log (app/api/chat/history/route.ts:11:17)

    console.log
      [Chat History] Fetching chats for session: session-123

      at log (app/api/chat/history/route.ts:26:17)

    console.error
      [Chat History] Error fetching chat history: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/history/route.ts:51:17)
      at Object.<anonymous> (__tests__/api/chat-history.test.ts:180:24)

    console.log
      [Chat History] DELETE request received

      at log (app/api/chat/history/route.ts:64:13)

    console.log
      [Chat History] Deleted 5 chats for session: session-123

      at log (app/api/chat/history/route.ts:80:17)

    console.log
      [Chat History] DELETE request received

      at log (app/api/chat/history/route.ts:64:13)

    console.log
      [Chat History] DELETE request received

      at log (app/api/chat/history/route.ts:64:13)

    console.log
      [Chat History] Deleted 0 chats for session: empty-session

      at log (app/api/chat/history/route.ts:80:17)

    console.log
      [Chat History] DELETE request received

      at log (app/api/chat/history/route.ts:64:13)

    console.error
      [Chat History] Error deleting chat history: Error: Delete failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/chat-history.test.ts:235:57)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/history/route.ts:88:17)
      at Object.<anonymous> (__tests__/api/chat-history.test.ts:239:24)

    console.log
      [Chat History] DELETE request received

      at log (app/api/chat/history/route.ts:64:13)

    console.error
      [Chat History] Error deleting chat history: String error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/chat/history/route.ts:88:17)
      at Object.<anonymous> (__tests__/api/chat-history.test.ts:253:24)

PASS __tests__/lib-and-models/db-and-models.import.test.ts
  ● Console

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Connection cleared

      at Object.log (lib/mongodb.ts:81:17)

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Using cached connection

      at Object.log (lib/mongodb.ts:35:21)

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Cached connection is stale, clearing...

      at Object.log (lib/mongodb.ts:38:21)

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.error
      [MongoDB] Connection failed: Connection failed

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (lib/mongodb.ts:58:21)
      at Object.dbConnect (lib/mongodb.ts:65:23)
      at Object.<anonymous> (__tests__/lib-and-models/db-and-models.import.test.ts:116:5)

    console.error
      [MongoDB] Connection error: Error: Connection failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/lib-and-models/db-and-models.import.test.ts:27:29)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as connect] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at Object.connect (/home/pelocal/pelocal/pelocal_voice_ai_agent/lib/mongodb.ts:54:35)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/lib-and-models/db-and-models.import.test.ts:116:29)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at Object.error (lib/mongodb.ts:68:17)
      at Object.<anonymous> (__tests__/lib-and-models/db-and-models.import.test.ts:116:5)

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Connection cleared

      at Object.log (lib/mongodb.ts:81:17)

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

PASS __tests__/hooks/useVoiceRecorder.unmount-cleanup.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:153:25)

    console.log
      [useVoiceRecorder] Final MIME type: audio/webm;codecs=opus

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)

PASS __tests__/api/llm.generate-fallbacks.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generate method

      at log (app/api/llm/route.ts:186:25)

    console.log
      [LLM] Retrying generate with direct string parameter

      at log (app/api/llm/route.ts:191:29)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: retry-ok

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: retry-ok

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 8

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["response"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: from-response-text

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 18

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hi there',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hi there

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 16

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hi there

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: direct-text-field

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 17

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Fallback please',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Fallback please

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.error
      [LLM] Could not initialize gemini-2.0-flash, attempting fallback model (gemini-pro). init-fail

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:117:21)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:116:17)

    console.log
      [LLM] Using fallback model: gemini-pro

      at log (app/api/llm/route.ts:120:25)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 23

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Fallback please

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["text"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: ok-after-fallback

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 17

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'No methods',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: No methods

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 18

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: No methods

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.error
      [LLM] Model does not expose generateContent or generate methods

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:196:25)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:132:17)

    console.error
      [LLM] Error while calling model.generate/generateContent: Error: Model does not expose generateContent or generate methods
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:197:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.generate-fallbacks.test.ts:132:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:265:21)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:132:17)

    console.log
      [LLM] Error status: null body: Model does not expose generateContent or generate methods

      at log (app/api/llm/route.ts:271:21)

    console.error
      [LLM] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:292:25)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:132:17)

    console.error
      [LLM] Error message: Model does not expose generateContent or generate methods

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:293:25)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:132:17)

    console.error
      [LLM] Error stack: Error: Model does not expose generateContent or generate methods
          at POST (/home/pelocal/pelocal/pelocal_voice_ai_agent/app/api/llm/route.ts:197:23)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/llm.generate-fallbacks.test.ts:132:17)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:294:25)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:132:17)

    console.error
      [LLM] Returning generic generate error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/llm/route.ts:314:21)
      at Object.<anonymous> (__tests__/api/llm.generate-fallbacks.test.ts:132:17)

PASS __tests__/hooks/useVoiceRecorder.mime-and-start.test.tsx
  ● Console

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] startRecording called

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:109:17)

    console.log
      [useVoiceRecorder] Requesting microphone access...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:112:21)

    console.log
      [useVoiceRecorder] Microphone access granted

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:126:21)

    console.log
      [useVoiceRecorder] Audio tracks: [
        {
          label: 'Mock Audio Track',
          enabled: true,
          muted: false,
          settings: { channelCount: 1, sampleRate: 44100 }
        }
      ]

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:127:21)

    console.log
      [useVoiceRecorder] Setting up AudioContext and Analyser...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:137:21)

    console.log
      [useVoiceRecorder] AudioContext state: running

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:143:21)

    console.log
      [useVoiceRecorder] Checking supported MIME types...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:150:21)

    console.log
      [useVoiceRecorder] Using browser default MIME type

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:166:25)

    console.log
      [useVoiceRecorder] Final MIME type: browser default

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:173:21)

    console.log
      [useVoiceRecorder] Creating MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:176:21)

    console.log
      [useVoiceRecorder] Starting MediaRecorder...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:223:21)

    console.log
      [useVoiceRecorder] isListening set to true

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:229:21)

    console.log
      [useVoiceRecorder] Starting VAD (Voice Activity Detection) monitoring...

      at Object.log [as startRecording] (hooks/useVoiceRecorder.ts:232:21)

    console.log
      [useVoiceRecorder] Silence detected, starting timer

      at log (hooks/useVoiceRecorder.ts:92:25)

    console.log
      [useVoiceRecorder] Hook initialized with: { silenceThreshold: 0.005, silenceTimeout: 750 }

      at log (hooks/useVoiceRecorder.ts:21:13)

    console.log
      [useVoiceRecorder] MediaRecorder started

      at Object.log [as onstart] (hooks/useVoiceRecorder.ts:220:25)

    console.log
      [useVoiceRecorder] Component unmounting, cleaning up...

      at log (hooks/useVoiceRecorder.ts:293:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] stopRecording called

      at log (hooks/useVoiceRecorder.ts:243:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] isListening set to false

      at log (hooks/useVoiceRecorder.ts:248:17)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Clearing silence timer

      at log (hooks/useVoiceRecorder.ts:256:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Cancelling animation frame

      at log (hooks/useVoiceRecorder.ts:262:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping media stream tracks

      at log (hooks/useVoiceRecorder.ts:267:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Stopping track: Mock Audio Track

      at log (hooks/useVoiceRecorder.ts:269:25)
          at Array.forEach (<anonymous>)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Closing AudioContext, state: running

      at log (hooks/useVoiceRecorder.ts:276:21)
          at Array.forEach (<anonymous>)

    console.log
      [useVoiceRecorder] Recording stopped and cleaned up

      at log (hooks/useVoiceRecorder.ts:283:17)
          at Array.forEach (<anonymous>)

PASS __tests__/lib/mongodb.test.ts
  ● Console

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Using cached connection

      at log (lib/mongodb.ts:35:21)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Cached connection is stale, clearing...

      at log (lib/mongodb.ts:38:21)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.error
      [MongoDB] Connection failed: connect fail

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (lib/mongodb.ts:58:21)
      at dbConnect (lib/mongodb.ts:65:23)
      at Object.<anonymous> (__tests__/lib/mongodb.test.ts:90:7)

    console.error
      [MongoDB] Connection error: Error: connect fail
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/lib/mongodb.test.ts:79:70)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as connect] (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-mock/build/index.js:102:19)
          at connect (/home/pelocal/pelocal/pelocal_voice_ai_agent/lib/mongodb.ts:54:35)
          at Object.dbConnect (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/lib/mongodb.test.ts:90:13)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (lib/mongodb.ts:68:17)
      at Object.<anonymous> (__tests__/lib/mongodb.test.ts:90:7)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Connection cleared

      at Object.log (lib/mongodb.ts:81:17)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

PASS __tests__/api/phone-numbers.route.test.ts
  ● Console

    console.log
      [Phone Numbers API] GET request received

      at log (app/api/phone-numbers/route.ts:56:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:63:17)

    console.log
      [Phone Numbers API] Found 1 phone numbers for user: user-1

      at log (app/api/phone-numbers/route.ts:72:17)

    console.log
      [Phone Numbers API] GET request received

      at log (app/api/phone-numbers/route.ts:56:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:63:17)

    console.log
      [Phone Numbers API] Found 1 phone numbers for user: mukul

      at log (app/api/phone-numbers/route.ts:72:17)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: undefined,
        phoneNumber: '',
        provider: undefined,
        displayName: '',
        hasExotelConfig: false,
        linkedAgentId: undefined
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.error
      [Phone Numbers API] Missing required fields

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/phone-numbers/route.ts:151:21)
      at Object.<anonymous> (__tests__/api/phone-numbers.route.test.ts:149:22)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: undefined,
        phoneNumber: '+1555000',
        provider: undefined,
        displayName: 'Primary',
        hasExotelConfig: false,
        linkedAgentId: undefined
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.log
      [Phone Numbers API] POST request received

      at log (app/api/phone-numbers/route.ts:125:13)

    console.log
      [Phone Numbers API] Connected to MongoDB

      at log (app/api/phone-numbers/route.ts:129:17)

    console.log
      [Phone Numbers API] Request data: {
        userId: 'user-1',
        phoneNumber: '+1555666',
        provider: 'exotel',
        displayName: 'Sales',
        hasExotelConfig: true,
        linkedAgentId: 'agent-9'
      }

      at log (app/api/phone-numbers/route.ts:141:17)

    console.log
      [Phone Numbers API] Phone number saved successfully, ID: mock-phone-id

      at log (app/api/phone-numbers/route.ts:189:17)

PASS __tests__/app/layout.test.tsx
  ● Console

    console.error
      In HTML, <html> cannot be a child of <div>.
      This will cause a hydration error.

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at validateDOMNesting (node_modules/react-dom/cjs/react-dom-client.development.js:2606:19)
      at resolveSingletonInstance (node_modules/react-dom/cjs/react-dom-client.development.js:19684:9)
      at completeWork (node_modules/react-dom/cjs/react-dom-client.development.js:11268:29)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:1522:13)
      at completeUnitOfWork (node_modules/react-dom/cjs/react-dom-client.development.js:15268:19)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom-client.development.js:15149:11)
      at workLoopSync (node_modules/react-dom/cjs/react-dom-client.development.js:14956:41)
      at renderRootSync (node_modules/react-dom/cjs/react-dom-client.development.js:14936:11)
      at performWorkOnRoot (node_modules/react-dom/cjs/react-dom-client.development.js:14419:13)
      at performWorkOnRootViaSchedulerTask (node_modules/react-dom/cjs/react-dom-client.development.js:16216:7)
      at flushActQueue (node_modules/react/cjs/react.development.js:566:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:860:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/app/layout.test.tsx:7:11)

PASS __tests__/api/config-status.test.ts
  ● Console

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: true, llm: true, tts: true }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: true

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: false, llm: true, tts: true }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: true, llm: false, tts: true }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: true, llm: true, tts: false }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: false, llm: false, tts: false }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: false, llm: false, tts: false }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: false, llm: false, tts: false }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

    console.log
      [config-status] GET request received

      at log (app/api/config-status/route.ts:4:13)

    console.log
      [config-status] Checking environment variables...

      at log (app/api/config-status/route.ts:5:13)

    console.log
      [config-status] Configuration status: { stt: true, llm: false, tts: false }

      at log (app/api/config-status/route.ts:16:13)

    console.log
      [config-status] All configured: false

      at log (app/api/config-status/route.ts:23:13)

PASS __tests__/app/home-renders-dashboard.test.tsx
PASS __tests__/api/tts.status-mapping.test.ts
  ● Console

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: hi

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 2 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: 401 Unauthorized API_KEY
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:20:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:22:17)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:22:17)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:22:17)

    console.error
      [TTS] Error message: 401 Unauthorized API_KEY

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:22:17)

    console.error
      [TTS] Error stack: Error: 401 Unauthorized API_KEY
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:20:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:22:17)

    console.error
      [TTS] Invalid API key detected

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:94:25)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:22:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: hi

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 2 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: 402 credits exceeded
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:28:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:30:17)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:30:17)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:30:17)

    console.error
      [TTS] Error message: 402 credits exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:30:17)

    console.error
      [TTS] Error stack: Error: 402 credits exceeded
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:28:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:30:17)

    console.error
      [TTS] Insufficient credits

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:98:25)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:30:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: hi

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 2 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: 429
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:36:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:38:17)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:38:17)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:38:17)

    console.error
      [TTS] Error message: 429

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:38:17)

    console.error
      [TTS] Error stack: Error: 429
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:36:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:38:17)

    console.error
      [TTS] Rate limit exceeded

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:102:25)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:38:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: hi

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 2 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: API_KEY invalid
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:44:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:46:17)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:46:17)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:46:17)

    console.error
      [TTS] Error message: API_KEY invalid

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:46:17)

    console.error
      [TTS] Error stack: Error: API_KEY invalid
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:44:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:46:17)

    console.error
      [TTS] Invalid API key detected

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:94:25)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:46:17)

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: hi

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 2 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: insufficient credits
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:52:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:54:17)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:54:17)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:54:17)

    console.error
      [TTS] Error message: insufficient credits

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:54:17)

    console.error
      [TTS] Error stack: Error: insufficient credits
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.status-mapping.test.ts:52:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:54:17)

    console.error
      [TTS] Insufficient credits

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:98:25)
      at Object.<anonymous> (__tests__/api/tts.status-mapping.test.ts:54:17)

PASS __tests__/api/campaigns.retrigger.test.ts
  ● Console

    console.error
      Error retriggering campaign in background: Error: background failure
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.retrigger.test.ts:120:52)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/[campaignId]/retrigger/route.ts:72:21)

    console.error
      Error retriggering campaign: Error: Update failed
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/campaigns.retrigger.test.ts:164:58)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/[campaignId]/retrigger/route.ts:78:17)
      at Object.<anonymous> (__tests__/api/campaigns.retrigger.test.ts:170:22)

    console.error
      Error retriggering campaign: non-error rejection

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/campaigns/[campaignId]/retrigger/route.ts:78:17)
      at Object.<anonymous> (__tests__/api/campaigns.retrigger.test.ts:195:22)

PASS __tests__/api/telephony-ws.test.ts
PASS __tests__/lib/exotel.test.ts
  ● Console

    console.error
      Exotel API Error: Error: network down
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/lib/exotel.test.ts:188:32)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (lib/exotel.ts:117:13)
      at Object.triggerBulkCalls (lib/exotel.ts:137:20)
      at Object.<anonymous> (__tests__/lib/exotel.test.ts:191:23)

PASS __tests__/api/upload-audio.backoff-timeout.test.ts
  ● Console

    console.log
      [upload-audio] POST request received

      at log (app/api/upload-audio/route.ts:8:13)

    console.log
      [upload-audio] Parsing form data...

      at log (app/api/upload-audio/route.ts:11:17)

    console.log
      [upload-audio] Received audio file: { name: 'a.webm', size: 3, type: 'audio/webm' }

      at log (app/api/upload-audio/route.ts:27:17)

    console.log
      [upload-audio] Step 1: Uploading to AssemblyAI...

      at log (app/api/upload-audio/route.ts:40:17)

    console.log
      [upload-audio] Audio buffer size: 3 bytes

      at log (app/api/upload-audio/route.ts:43:17)

    console.log
      [upload-audio] Upload response status: 200

      at log (app/api/upload-audio/route.ts:54:17)

    console.log
      [upload-audio] Audio uploaded successfully, URL: u

      at log (app/api/upload-audio/route.ts:64:17)

    console.log
      [upload-audio] Step 2: Creating transcription job...

      at log (app/api/upload-audio/route.ts:67:17)

    console.log
      [upload-audio] Transcription job response status: 200

      at log (app/api/upload-audio/route.ts:84:17)

    console.log
      [upload-audio] Transcription job created, ID: tx

      at log (app/api/upload-audio/route.ts:94:17)

    console.log
      [upload-audio] Step 3: Polling for transcription completion...

      at log (app/api/upload-audio/route.ts:97:17)

    console.log
      [upload-audio] Polling attempt 1/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 1000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 2/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 1500ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 3/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 2250ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 4/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 3375ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 5/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 6/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 7/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 8/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 9/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 10/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 11/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 12/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 13/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 14/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 15/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 16/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 17/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 18/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 19/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 20/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 21/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 22/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 23/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 24/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 25/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 26/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 27/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 28/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 29/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 30/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 31/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 32/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 33/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 34/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 35/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 36/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 37/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 38/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 39/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 40/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 41/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 42/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 43/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 44/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 45/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 46/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 47/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 48/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 49/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 50/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 51/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 52/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 53/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 54/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 55/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 56/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 57/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 58/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 59/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.log
      [upload-audio] Polling attempt 60/60...

      at log (app/api/upload-audio/route.ts:104:21)

    console.log
      [upload-audio] Status check response: 200

      at log (app/api/upload-audio/route.ts:112:21)

    console.log
      [upload-audio] Transcription status: processing

      at log (app/api/upload-audio/route.ts:121:21)

    console.log
      [upload-audio] Waiting 5000ms before next attempt...

      at log (app/api/upload-audio/route.ts:136:21)

    console.error
      [upload-audio] Transcription timeout after 60 attempts

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/upload-audio/route.ts:142:17)

PASS __tests__/api/llm.extractText-variants.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["candidates"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Output from candidates[0].output

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 32

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["candidates"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: Output from candidates[0].content

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 33

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

PASS __tests__/api/tts.invalid-key-catch.test.ts
  ● Console

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: Hello

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 5 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.error
      [TTS] TTS API error: Error: 401 Unauthorized: Invalid API key
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.invalid-key-catch.test.ts:21:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:80:17)
      at Object.<anonymous> (__tests__/api/tts.invalid-key-catch.test.ts:28:17)

    console.error
      [TTS] Error details: {}

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:84:21)
      at Object.<anonymous> (__tests__/api/tts.invalid-key-catch.test.ts:28:17)

    console.error
      [TTS] Error type: Error

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:89:21)
      at Object.<anonymous> (__tests__/api/tts.invalid-key-catch.test.ts:28:17)

    console.error
      [TTS] Error message: 401 Unauthorized: Invalid API key

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:90:21)
      at Object.<anonymous> (__tests__/api/tts.invalid-key-catch.test.ts:28:17)

    console.error
      [TTS] Error stack: Error: 401 Unauthorized: Invalid API key
          at Object.<anonymous> (/home/pelocal/pelocal/pelocal_voice_ai_agent/__tests__/api/tts.invalid-key-catch.test.ts:21:56)
          at Promise.finally.completed (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/pelocal/pelocal/pelocal_voice_ai_agent/node_modules/jest-runner/build/testWorker.js:497:12)

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:91:21)
      at Object.<anonymous> (__tests__/api/tts.invalid-key-catch.test.ts:28:17)

    console.error
      [TTS] Invalid API key detected

      311 |       return
      312 |     }
    > 313 |     originalError.call(console, ...args)
          |                   ^
      314 |   }
      315 | })
      316 |

      at console.call [as error] (jest.setup.js:313:19)
      at error (app/api/tts/route.ts:94:25)
      at Object.<anonymous> (__tests__/api/tts.invalid-key-catch.test.ts:28:17)

PASS __tests__/lib/whatsAppService.session-id.test.ts
PASS __tests__/api/llm.extract-fallback-json.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'Hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [MongoDB] Creating new connection...

      at log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: Hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: Hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["foo","answer"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: {"foo":"bar","answer":42}

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 25

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

PASS __tests__/api/llm.extract-more.test.ts
  ● Console

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hi',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hi

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 10

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hi

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["output"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: plain-content

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 13

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

    console.log
      [LLM] POST request received

      at log (app/api/llm/route.ts:46:13)

    console.log
      [LLM] Parsing request body...

      at log (app/api/llm/route.ts:49:17)

    console.log
      [LLM] Request data: {
        hasPrompt: false,
        promptLength: undefined,
        userText: 'hello',
        sessionId: undefined,
        historyLength: 0
      }

      at log (app/api/llm/route.ts:51:17)

    console.log
      [LLM] Connected to MongoDB

      at log (app/api/llm/route.ts:66:17)

    console.log
      [LLM] Total messages in conversation: 1 Save to history: false

      at log (app/api/llm/route.ts:75:17)

    console.log
      [LLM] Skipping user message save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:94:21)

    console.log
      [LLM] Gemini API Key present: true

      at log (app/api/llm/route.ts:103:17)

    console.log
      [LLM] User text: hello

      at log (app/api/llm/route.ts:104:17)

    console.log
      [LLM] Initializing GoogleGenerativeAI...

      at log (app/api/llm/route.ts:107:17)

    console.log
      [LLM] Attempting to load gemini-2.0-flash model...

      at log (app/api/llm/route.ts:113:21)

    console.log
      [LLM] Using model: gemini-2.0-flash

      at log (app/api/llm/route.ts:115:21)

    console.log
      [LLM] Formatting conversation history, total messages: 0

      at log (app/api/llm/route.ts:20:13)

    console.log
      [LLM] Formatted prompt with 0 previous messages

      at log (app/api/llm/route.ts:41:13)

    console.log
      [LLM] Full prompt length: 13

      at log (app/api/llm/route.ts:133:17)

    console.log
      [LLM] Sending prompt to Gemini (trimmed preview): 
      
      User: hello

      at log (app/api/llm/route.ts:134:17)

    console.log
      [LLM] Calling model.generateContent...

      at log (app/api/llm/route.ts:178:21)

    console.log
      [LLM] Using generateContent method

      at log (app/api/llm/route.ts:183:25)

    console.log
      [LLM] Model generation completed

      at log (app/api/llm/route.ts:200:21)

    console.log
      [LLM] Gemini raw result sample: ["candidates"]

      at log (app/api/llm/route.ts:203:21)

    console.log
      [LLM] Extracted LLM text preview: candidate-content

      at log (app/api/llm/route.ts:204:21)

    console.log
      [LLM] Successfully generated response, length: 17

      at log (app/api/llm/route.ts:211:21)

    console.log
      [LLM] Skipping assistant response save (conversation has <=2 messages)

      at log (app/api/llm/route.ts:229:25)

PASS __tests__/models/PhoneNumber.schema.test.ts
PASS __tests__/models/ensureIndexFallback.test.ts
PASS __tests__/models/index.test.ts
PASS __tests__/lib/whatsappUtils.test.ts
PASS __tests__/api/tts.extra.test.ts
  ● Console

    console.log
      [TTS] POST request received

      at log (app/api/tts/route.ts:8:13)

    console.log
      [TTS] Parsing request body...

      at log (app/api/tts/route.ts:11:17)

    console.log
      [TTS] Text to convert: x

      at log (app/api/tts/route.ts:13:17)

    console.log
      [TTS] Sarvam API key present: true

      at log (app/api/tts/route.ts:26:17)

    console.log
      [TTS] Text length: 1 characters

      at log (app/api/tts/route.ts:27:17)

    console.log
      [TTS] Calling Sarvam TTS API with Manisha voice...

      at log (app/api/tts/route.ts:30:17)

    console.log
      [TTS] Sarvam response status: 200

      at log (app/api/tts/route.ts:50:17)

    console.log
      [TTS] Sarvam response headers: {}

      at log (app/api/tts/route.ts:51:17)

    console.log
      [TTS] Parsing Sarvam response...

      at log (app/api/tts/route.ts:60:17)

    console.log
      [TTS] Sarvam response structure: [ 'audios' ]

      at log (app/api/tts/route.ts:62:17)

    console.log
      [TTS] Base64 audio length: 4 characters

      at log (app/api/tts/route.ts:71:17)

    console.log
      [TTS] Returning audio data

      at log (app/api/tts/route.ts:73:17)

PASS __tests__/models/models.test.ts
PASS __tests__/lib-and-models/db-and-models.import.esm-safe.test.ts
  ● Console

    console.log
      [MongoDB] Creating new connection...

      at Object.log (lib/mongodb.ts:53:17)

    console.log
      [MongoDB] Connected successfully

      at log (lib/mongodb.ts:55:21)

    console.log
      [MongoDB] Connection cleared

      at Object.log (lib/mongodb.ts:81:17)

PASS __tests__/lib/knowledge.test.ts

Test Suites: 116 passed, 116 total
Tests:       23 skipped, 1072 passed, 1095 total
Snapshots:   0 total
Time:        20.254 s, estimated 79 s
Ran all test suites.
